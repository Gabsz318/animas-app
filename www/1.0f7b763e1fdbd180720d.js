(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"I/3d":function(t,e,n){"use strict";n.d(e,"a",function(){return up});var r=n("fXoL"),i=n("D0XW"),o=n("HDdC"),s=n("Cfvw"),a=n("LRne"),u=n("JX91"),c=n("7o/Q");function h(){return t=>t.lift(new l)}class l{call(t,e){return e.subscribe(new f(t))}}class f extends c.a{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var d=n("lJxs"),p=n("Kqap"),y=n("/uUt"),v=n("pLZG"),g=n("pxpQ"),m=n("spgP"),b=n("ofXK"),w=n("Jgta"),I=n("zIRd"),T=n("qOnz"),E=n("q/0M"),_=function(t,e){return(_=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function O(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var S,D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},N=N||{},A=D||self;function k(){}function C(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function j(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var x="closure_uid_"+(1e9*Math.random()>>>0),R=0;function P(t,e,n){return t.call.apply(t.bind,arguments)}function L(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function F(t,e,n){return(F=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?P:L).apply(null,arguments)}function M(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function V(){return Date.now()}function q(t,e){function n(){}n.prototype=e.prototype,t.X=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Pb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function U(){this.j=this.j,this.i=this.i}U.prototype.j=!1,U.prototype.ka=function(){!this.j&&(this.j=!0,this.H(),0)&&function(t){Object.prototype.hasOwnProperty.call(t,x)&&t[x]||(t[x]=++R)}(this)},U.prototype.H=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var B=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},K=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function G(t){return Array.prototype.concat.apply([],arguments)}function z(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Q(t){return/^[\s\xa0]*$/.test(t)}var H,W=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function Y(t,e){return-1!=t.indexOf(e)}function X(t,e){return t<e?-1:t>e?1:0}t:{var $=A.navigator;if($){var J=$.userAgent;if(J){H=J;break t}}H=""}function Z(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function tt(t){var e={};for(var n in t)e[n]=t[n];return e}var et="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function nt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<et.length;o++)n=et[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function rt(t){return rt[" "](t),t}rt[" "]=k;var it,ot,st=Y(H,"Opera"),at=Y(H,"Trident")||Y(H,"MSIE"),ut=Y(H,"Edge"),ct=ut||at,ht=Y(H,"Gecko")&&!(Y(H.toLowerCase(),"webkit")&&!Y(H,"Edge"))&&!(Y(H,"Trident")||Y(H,"MSIE"))&&!Y(H,"Edge"),lt=Y(H.toLowerCase(),"webkit")&&!Y(H,"Edge");function ft(){var t=A.document;return t?t.documentMode:void 0}t:{var dt="",pt=(ot=H,ht?/rv:([^\);]+)(\)|;)/.exec(ot):ut?/Edge\/([\d\.]+)/.exec(ot):at?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ot):lt?/WebKit\/(\S+)/.exec(ot):st?/(?:Version)[ \/]?(\S+)/.exec(ot):void 0);if(pt&&(dt=pt?pt[1]:""),at){var yt=ft();if(null!=yt&&yt>parseFloat(dt)){it=String(yt);break t}}it=dt}var vt={};function gt(t){return function(t,e){var n=vt;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e()}(t,function(){for(var e=0,n=W(String(it)).split("."),r=W(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",a=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],0==s[0].length&&0==a[0].length)break;e=X(0==s[1].length?0:parseInt(s[1],10),0==a[1].length?0:parseInt(a[1],10))||X(0==s[2].length,0==a[2].length)||X(s[2],a[2]),s=s[3],a=a[3]}while(0==e)}return 0<=e})}var mt=A.document&&at&&(ft()||parseInt(it,10))||void 0,bt=!at||9<=Number(mt),wt=at&&!gt("9"),It=function(){if(!A.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{A.addEventListener("test",k,e),A.removeEventListener("test",k,e)}catch(n){}return t}();function Tt(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Et(t,e){if(Tt.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ht){t:{try{rt(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}Tt.prototype.b=function(){this.defaultPrevented=!0},q(Et,Tt);var _t={2:"touch",3:"pen",4:"mouse"};Et.prototype.b=function(){Et.X.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,wt)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(e){}};var Ot="closure_listenable_"+(1e6*Math.random()|0),St=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++St,this.Y=this.Z=!1}function Nt(t){t.Y=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function At(t){this.src=t,this.a={},this.b=0}function kt(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=B(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Nt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Ct(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.Y&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}At.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Ct(t,e,r,i);return-1<s?(e=t[s],n||(e.Z=!1)):((e=new Dt(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var jt="closure_lm_"+(1e6*Math.random()|0),xt={};function Rt(t,e,n,r,i){if(r&&r.once)return Lt(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Rt(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[Ot]?t.wa(e,n,j(r)?!!r.capture:!!r,i):Pt(t,e,n,!1,r,i)}function Pt(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=j(i)?!!i.capture:!!i;if(s&&!bt)return null;var a=Bt(t);if(a||(t[jt]=a=new At(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Ut,e=bt?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)It||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Vt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Lt(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Lt(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[Ot]?t.xa(e,n,j(r)?!!r.capture:!!r,i):Pt(t,e,n,!0,r,i)}function Ft(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)Ft(t,e[o],n,r,i);else r=j(r)?!!r.capture:!!r,n=Gt(n),t&&t[Ot]?(t=t.c,(e=String(e).toString())in t.a&&-1<(n=Ct(o=t.a[e],n,r,i))&&(Nt(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--))):t&&(t=Bt(t))&&(e=t.a[e.toString()],t=-1,e&&(t=Ct(e,n,r,i)),(n=-1<t?e[t]:null)&&Mt(n))}function Mt(t){if("number"!=typeof t&&t&&!t.Y){var e=t.src;if(e&&e[Ot])kt(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Vt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Bt(e))?(kt(n,t),0==n.b&&(n.src=null,e[jt]=null)):Nt(t)}}}function Vt(t){return t in xt?xt[t]:xt[t]="on"+t}function qt(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Mt(t),n.call(r,e)}function Ut(t,e){if(t.Y)return!0;if(!bt){if(!e)t:{e=["window","event"];for(var n=A,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return qt(t,e=new Et(e,this))}return qt(t,new Et(e,this))}function Bt(t){return(t=t[jt])instanceof At?t:null}var Kt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(t){return"function"==typeof t?t:(t[Kt]||(t[Kt]=function(e){return t.handleEvent(e)}),t[Kt])}function zt(){U.call(this),this.c=new At(this),this.J=this,this.D=null}function Qt(t,e){var n,r=t.D;if(r)for(n=[];r;r=r.D)n.push(r);if(t=t.J,r=e.type||e,"string"==typeof e)e=new Tt(e,t);else if(e instanceof Tt)e.target=e.target||t;else{var i=e;nt(e=new Tt(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.a=n[o];i=Ht(s,r,!0,e)&&i}if(i=Ht(s=e.a=t,r,!0,e)&&i,i=Ht(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Ht(s=e.a=n[o],r,!1,e)&&i}function Ht(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.Y&&s.capture==n){var a=s.listener,u=s.da||s.src;s.Z&&kt(t.c,s),i=!1!==a.call(u,r)&&i}}return i&&!r.defaultPrevented}q(zt,U),zt.prototype[Ot]=!0,(S=zt.prototype).addEventListener=function(t,e,n,r){Rt(this,t,e,n,r)},S.removeEventListener=function(t,e,n,r){Ft(this,t,e,n,r)},S.H=function(){if(zt.X.H.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Nt(n[r]);delete e.a[t],e.b--}}this.D=null},S.wa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},S.xa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Wt=A.JSON.stringify;function Yt(){this.b=this.a=null}var Xt,$t=new(function(){function t(t,e){this.c=t,this.f=e,this.b=0,this.a=null}return t.prototype.get=function(){var t;return 0<this.b?(this.b--,this.a=(t=this.a).next,t.next=null):t=this.c(),t},t}())(function(){return new Zt},function(t){t.reset()});function Jt(){var t=re,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Zt(){this.next=this.b=this.a=null}function te(t){A.setTimeout(function(){throw t},0)}function ee(t,e){Xt||function(){var t=A.Promise.resolve(void 0);Xt=function(){t.then(ie)}}(),ne||(Xt(),ne=!0),re.add(t,e)}Yt.prototype.add=function(t,e){var n=$t.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Zt.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Zt.prototype.reset=function(){this.next=this.b=this.a=null};var ne=!1,re=new Yt;function ie(){for(var t;t=Jt();){try{t.a.call(t.b)}catch(n){te(n)}var e=$t;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}ne=!1}function oe(t,e){zt.call(this),this.b=t||1,this.a=e||A,this.f=F(this.eb,this),this.g=V()}function se(t){t.aa=!1,t.M&&(t.a.clearTimeout(t.M),t.M=null)}function ae(t,e,n){if("function"==typeof t)n&&(t=F(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=F(t.handleEvent,t)}return 2147483647<Number(e)?-1:A.setTimeout(t,e||0)}function ue(t){t.a=ae(function(){t.a=null,t.c&&(t.c=!1,ue(t))},t.h);var e=t.b;t.b=null,t.g.apply(null,e)}q(oe,zt),(S=oe.prototype).aa=!1,S.M=null,S.eb=function(){if(this.aa){var t=V()-this.g;0<t&&t<.8*this.b?this.M=this.a.setTimeout(this.f,this.b-t):(this.M&&(this.a.clearTimeout(this.M),this.M=null),Qt(this,"tick"),this.aa&&(se(this),this.start()))}},S.start=function(){this.aa=!0,this.M||(this.M=this.a.setTimeout(this.f,this.b),this.g=V())},S.H=function(){oe.X.H.call(this),se(this),delete this.a};var ce=function(t){function e(e,n){var r=t.call(this)||this;return r.g=e,r.h=n,r.b=null,r.c=!1,r.a=null,r}return function(t,e){function n(){this.constructor=t}_(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.f=function(t){this.b=arguments,this.a?this.c=!0:ue(this)},e.prototype.H=function(){t.prototype.H.call(this),this.a&&(A.clearTimeout(this.a),this.a=null,this.c=!1,this.b=null)},e}(U);function he(t){U.call(this),this.b=t,this.a={}}q(he,U);var le=[];function fe(t,e,n,r){Array.isArray(n)||(n&&(le[0]=n.toString()),n=le);for(var i=0;i<n.length;i++){var o=Rt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function de(t){Z(t.a,function(t,e){this.a.hasOwnProperty(e)&&Mt(t)},t),t.a={}}function pe(){this.a=!0}function ye(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.a)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Wt(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}he.prototype.H=function(){he.X.H.call(this),de(this)},he.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},pe.prototype.info=function(){};var ve={},ge=null;function me(){return ge=ge||new zt}function be(t){Tt.call(this,ve.Ga,t)}function we(t){var e=me();Qt(e,new be(e,t))}function Ie(t,e){Tt.call(this,ve.STAT_EVENT,t),this.stat=e}function Te(t){var e=me();Qt(e,new Ie(e,t))}function Ee(t){Tt.call(this,ve.Ha,t)}function _e(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return A.setTimeout(function(){t()},e)}ve.Ga="serverreachability",q(be,Tt),ve.STAT_EVENT="statevent",q(Ie,Tt),ve.Ha="timingevent",q(Ee,Tt);var Oe={NO_ERROR:0,fb:1,sb:2,rb:3,mb:4,qb:5,tb:6,Ea:7,TIMEOUT:8,wb:9},Se={kb:"complete",Gb:"success",Fa:"error",Ea:"abort",yb:"ready",zb:"readystatechange",TIMEOUT:"timeout",ub:"incrementaldata",xb:"progress",nb:"downloadprogress",Ob:"uploadprogress"};function De(){}function Ne(){}De.prototype.b=null;var Ae,ke={OPEN:"a",jb:"b",Fa:"c",vb:"d"};function Ce(){Tt.call(this,"d")}function je(){Tt.call(this,"c")}function xe(){}function Re(t,e,n,r){this.g=t,this.c=e,this.f=n,this.S=r||1,this.J=new he(this),this.P=Pe,this.R=new oe(t=ct?125:void 0),this.B=null,this.b=!1,this.j=this.l=this.i=this.G=this.u=this.T=this.o=null,this.s=[],this.a=null,this.D=0,this.h=this.m=null,this.N=-1,this.A=!1,this.O=0,this.F=null,this.V=this.C=this.U=this.I=!1}q(Ce,Tt),q(je,Tt),q(xe,De),xe.prototype.a=function(){return new XMLHttpRequest},xe.prototype.c=function(){return{}},Ae=new xe;var Pe=45e3,Le={},Fe={};function Me(t,e,n){t.G=1,t.i=an(tn(e)),t.j=n,t.I=!0,Ve(t,null)}function Ve(t,e){t.u=V(),Be(t),t.l=tn(t.i);var n=t.l,r=t.S;Array.isArray(r)||(r=[String(r)]),wn(n.b,"t",r),t.D=0,t.a=pr(t.g,t.g.C?e:null),0<t.O&&(t.F=new ce(F(t.Da,t,t.a),t.O)),fe(t.J,t.a,"readystatechange",t.bb),e=t.B?tt(t.B):{},t.j?(t.m||(t.m="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ba(t.l,t.m,t.j,e)):(t.m="GET",t.a.ba(t.l,t.m,null,e)),we(1),function(t,e,n,r,i,o){t.info(function(){if(t.a)if(o)for(var s="",a=o.split("&"),u=0;u<a.length;u++){var c=a[u].split("=");if(1<c.length){var h=c[0];c=c[1];var l=h.split("_");s=2<=l.length&&"type"==l[1]?s+(h+"=")+c+"&":s+(h+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.c,t.m,t.l,t.f,t.S,t.j)}function qe(t,e,n){for(var r=!0;!t.A&&t.D<n.length;){var i=Ue(t,n);if(i==Fe){4==e&&(t.h=4,Te(14),r=!1),ye(t.c,t.f,null,"[Incomplete Response]");break}if(i==Le){t.h=4,Te(15),ye(t.c,t.f,n,"[Invalid Chunk]"),r=!1;break}ye(t.c,t.f,i,null),He(t,i)}4==e&&0==n.length&&(t.h=1,Te(16),r=!1),t.b=t.b&&r,r?0<n.length&&!t.V&&(t.V=!0,(e=t.g).a==t&&e.U&&!e.F&&(e.c.info("Great, no buffering proxy detected. Bytes received: "+n.length),sr(e),e.F=!0,Te(11))):(ye(t.c,t.f,n,"[Invalid Chunked Response]"),Qe(t),ze(t))}function Ue(t,e){var n=t.D,r=e.indexOf("\n",n);return-1==r?Fe:(n=Number(e.substring(n,r)),isNaN(n)?Le:(r+=1)+n>e.length?Fe:(e=e.substr(r,n),t.D=r+n,e))}function Be(t){t.T=V()+t.P,Ke(t,t.P)}function Ke(t,e){if(null!=t.o)throw Error("WatchDog timer not null");t.o=_e(F(t.$a,t),e)}function Ge(t){t.o&&(A.clearTimeout(t.o),t.o=null)}function ze(t){0==t.g.v||t.A||cr(t.g,t)}function Qe(t){Ge(t);var e=t.F;e&&"function"==typeof e.ka&&e.ka(),t.F=null,se(t.R),de(t.J),t.a&&(e=t.a,t.a=null,e.abort(),e.ka())}function He(t,e){try{var n=t.g;if(0!=n.v&&(n.a==t||Dn(n.b,t)))if(n.I=t.N,!t.C&&Dn(n.b,t)&&3==n.v){try{var r=n.la.a.parse(e)}catch(md){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.j){if(n.a){if(!(n.a.u+3e3<t.u))break t;ur(n),$n(n)}or(n),Te(18)}}else n.pa=i[1],0<n.pa-n.P&&37500>i[2]&&n.G&&0==n.o&&!n.m&&(n.m=_e(F(n.Xa,n),6e3));if(1>=Sn(n.b)&&n.fa){try{n.fa()}catch(md){}n.fa=void 0}}else lr(n,11)}else if((t.C||n.a==t)&&ur(n),!Q(e))for(e=r=n.la.a.parse(e),r=0;r<e.length;r++)if(n.P=(i=e[r])[0],i=i[1],2==n.v)if("c"==i[0]){n.J=i[1],n.ha=i[2];var o=i[3];null!=o&&(n.ia=o,n.c.info("VER="+n.ia));var s=i[4];null!=s&&(n.qa=s,n.c.info("SVER="+n.qa));var a=i[5];if(null!=a&&"number"==typeof a&&0<a){var u=1.5*a;n.D=u,n.c.info("backChannelRequestTimeoutMs_="+u)}u=n;var c=t.a;if(c){var h=c.a?c.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var l=u.b;!l.a&&(Y(h,"spdy")||Y(h,"quic")||Y(h,"h2"))&&(l.f=l.g,l.a=new Set,l.b&&(Nn(l,l.b),l.b=null))}if(u.A){var f=c.a?c.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.oa=f,sn(u.B,u.A,f))}}n.v=3,n.f&&n.f.ua(),n.U&&(n.N=V()-t.u,n.c.info("Handshake RTT: "+n.N+"ms"));var d=t;if((u=n).ma=dr(u,u.C?u.ha:null,u.ga),d.C){An(u.b,d);var p=d,y=u.D;y&&p.setTimeout(y),p.o&&(Ge(p),Be(p)),u.a=d}else ir(u);0<n.g.length&&tr(n)}else"stop"!=i[0]&&"close"!=i[0]||lr(n,7);else 3==n.v&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?lr(n,7):Xn(n):"noop"!=i[0]&&n.f&&n.f.ta(i),n.o=0);we(4)}catch(md){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(C(t)||"string"==typeof t)K(t,e,void 0);else{if(t.L&&"function"==typeof t.L)var n=t.L();else if(t.K&&"function"==typeof t.K)n=void 0;else if(C(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.K&&"function"==typeof t.K)return t.K();if("string"==typeof t)return t.split("");if(C(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Ye(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Ye)for(n=t.L(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function Xe(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];$e(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)$e(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function $e(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(S=Re.prototype).setTimeout=function(t){this.P=t},S.bb=function(t){t=t.target;var e=this.F;e&&3==Qn(t)?e.f():this.Da(t)},S.Da=function(t){try{if(t==this.a)t:{var e=Qn(this.a),n=this.a.va(),r=this.a.W();if(!(3>e||3==e&&!ct&&!this.a.$())){this.A||4!=e||7==n||we(8==n||0>=r?3:2),Ge(this);var i=this.a.W();this.N=i;var o=this.a.$();if(this.b=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.c,this.m,this.l,this.f,this.S,e,i),this.b){if(this.U&&!this.C){e:{if(this.a){var s,a=this.a;if((s=a.a?a.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Q(s)){var u=s;break e}}u=null}if(!u){this.b=!1,this.h=3,Te(12),Qe(this),ze(this);break t}ye(this.c,this.f,u,"Initial handshake response via X-HTTP-Initial-Response"),this.C=!0,He(this,u)}this.I?(qe(this,e,o),ct&&this.b&&3==e&&(fe(this.J,this.R,"tick",this.ab),this.R.start())):(ye(this.c,this.f,o,null),He(this,o)),4==e&&Qe(this),this.b&&!this.A&&(4==e?cr(this.g,this):(this.b=!1,Be(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.h=3,Te(12)):(this.h=0,Te(13)),Qe(this),ze(this)}}}catch(c){}},S.ab=function(){if(this.a){var t=Qn(this.a),e=this.a.$();this.D<e.length&&(Ge(this),qe(this,t,e),this.b&&4!=t&&Be(this))}},S.cancel=function(){this.A=!0,Qe(this)},S.$a=function(){this.o=null;var t=V();0<=t-this.T?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.c,this.l),2!=this.G&&(we(3),Te(17)),Qe(this),this.h=2,ze(this)):Ke(this,this.T-t)},(S=Ye.prototype).K=function(){Xe(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},S.L=function(){return Xe(this),this.a.concat()},S.get=function(t,e){return $e(this.b,t)?this.b[t]:e},S.set=function(t,e){$e(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},S.forEach=function(t,e){for(var n=this.L(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Je=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Ze(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Ze){this.a=void 0!==e?e:t.a,en(this,t.f),this.j=t.j,nn(this,t.c),rn(this,t.h),this.g=t.g,e=t.b;var n=new vn;n.c=e.c,e.a&&(n.a=new Ye(e.a),n.b=e.b),on(this,n),this.i=t.i}else t&&(n=String(t).match(Je))?(this.a=!!e,en(this,n[1]||"",!0),this.j=un(n[2]||""),nn(this,n[3]||"",!0),rn(this,n[4]),this.g=un(n[5]||"",!0),on(this,n[6]||"",!0),this.i=un(n[7]||"")):(this.a=!!e,this.b=new vn(null,this.a))}function tn(t){return new Ze(t)}function en(t,e,n){t.f=n?un(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function nn(t,e,n){t.c=n?un(e,!0):e}function rn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.h=e}else t.h=null}function on(t,e,n){e instanceof vn?(t.b=e,function(t,e){e&&!t.f&&(gn(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(mn(this,e),wn(this,n,t))},t)),t.f=e}(t.b,t.a)):(n||(e=cn(e,pn)),t.b=new vn(e,t.a))}function sn(t,e,n){t.b.set(e,n)}function an(t){return sn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^V()).toString(36)),t}function un(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function cn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,hn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function hn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Ze.prototype.toString=function(){var t=[],e=this.f;e&&t.push(cn(e,ln,!0),":");var n=this.c;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(cn(e,ln,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(cn(n,"/"==n.charAt(0)?dn:fn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",cn(n,yn)),t.join("")};var ln=/[#\/\?@]/g,fn=/[#\?:]/g,dn=/[#\?]/g,pn=/[#\?@]/g,yn=/#/g;function vn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function gn(t){t.a||(t.a=new Ye,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function mn(t,e){gn(t),e=In(t,e),$e(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,$e((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Xe(t)))}function bn(t,e){return gn(t),e=In(t,e),$e(t.a.b,e)}function wn(t,e,n){mn(t,e),0<n.length&&(t.c=null,t.a.set(In(t,e),z(n)),t.b+=n.length)}function In(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(S=vn.prototype).add=function(t,e){gn(this),this.c=null,t=In(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},S.forEach=function(t,e){gn(this),this.a.forEach(function(n,r){K(n,function(n){t.call(e,n,r,this)},this)},this)},S.L=function(){gn(this);for(var t=this.a.K(),e=this.a.L(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},S.K=function(t){gn(this);var e=[];if("string"==typeof t)bn(this,t)&&(e=G(e,this.a.get(In(this,t))));else{t=this.a.K();for(var n=0;n<t.length;n++)e=G(e,t[n])}return e},S.set=function(t,e){return gn(this),this.c=null,bn(this,t=In(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},S.get=function(t,e){return t&&0<(t=this.K(t)).length?String(t[0]):e},S.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.L(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.K(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var Tn=function(){return function(t,e){this.b=t,this.a=e}}();function En(t){this.g=t||_n,t=A.PerformanceNavigationTiming?0<(t=A.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(A.ja&&A.ja.za&&A.ja.za()&&A.ja.za().Qb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}var _n=10;function On(t){return!!t.b||!!t.a&&t.a.size>=t.f}function Sn(t){return t.b?1:t.a?t.a.size:0}function Dn(t,e){return t.b?t.b==e:!!t.a&&t.a.has(e)}function Nn(t,e){t.a?t.a.add(e):t.b=e}function An(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function kn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.s);if(null!=t.a&&0!==t.a.size){var r=t.c;try{for(var i=O(t.a.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.s)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return z(t.c)}function Cn(){}function jn(){this.a=new Cn}function xn(t,e,n){var r=n||"";try{We(t,function(t,n){var i=t;j(t)&&(i=Wt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(Bd){throw e.push(r+"type="+encodeURIComponent("_badmap")),Bd}}function Rn(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}En.prototype.cancel=function(){var t,e;if(this.c=kn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=O(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Cn.prototype.stringify=function(t){return A.JSON.stringify(t,void 0)},Cn.prototype.parse=function(t){return A.JSON.parse(t,void 0)};var Pn=A.JSON.parse;function Ln(t){zt.call(this),this.headers=new Ye,this.l=t||null,this.b=!1,this.u=this.a=null,this.C="",this.h=0,this.f="",this.g=this.B=this.m=this.A=!1,this.s=0,this.o=null,this.I=Fn,this.F=this.G=!1}q(Ln,zt);var Fn="",Mn=/^https?$/i,Vn=["POST","PUT"];function qn(t){return"content-type"==t.toLowerCase()}function Un(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Bn(t),Gn(t)}function Bn(t){t.A||(t.A=!0,Qt(t,"complete"),Qt(t,"error"))}function Kn(t){if(t.b&&void 0!==N&&(!t.u[1]||4!=Qn(t)||2!=t.W()))if(t.m&&4==Qn(t))ae(t.Aa,0,t);else if(Qt(t,"readystatechange"),4==Qn(t)){t.b=!1;try{var e,n=t.W();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.C).match(Je)[1]||null;if(!o&&A.self&&A.self.location){var s=A.self.location.protocol;o=s.substr(0,s.length-1)}i=!Mn.test(o?o.toLowerCase():"")}e=i}if(e)Qt(t,"complete"),Qt(t,"success");else{t.h=6;try{var a=2<Qn(t)?t.a.statusText:""}catch(n){a=""}t.f=a+" ["+t.W()+"]",Bn(t)}}finally{Gn(t)}}}function Gn(t,e){if(t.a){zn(t);var n=t.a,r=t.u[0]?k:null;t.a=null,t.u=null,e||Qt(t,"ready");try{n.onreadystatechange=r}catch(Bd){}}}function zn(t){t.a&&t.F&&(t.a.ontimeout=null),t.o&&(A.clearTimeout(t.o),t.o=null)}function Qn(t){return t.a?t.a.readyState:0}function Hn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return Z(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):sn(t,e,n))}function Wn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Yn(t){this.qa=0,this.g=[],this.c=new pe,this.ha=this.ma=this.B=this.ga=this.a=this.oa=this.A=this.V=this.i=this.O=this.l=null,this.Pa=this.R=0,this.Ma=Wn("failFast",!1,t),this.G=this.m=this.j=this.h=this.f=null,this.S=!0,this.I=this.pa=this.P=-1,this.T=this.o=this.u=0,this.Ia=Wn("baseRetryDelayMs",5e3,t),this.Sa=Wn("retryDelaySeedMs",1e4,t),this.Na=Wn("forwardChannelMaxRetries",2,t),this.na=Wn("forwardChannelRequestTimeoutMs",2e4,t),this.Oa=t&&t.xmlHttpFactory||void 0,this.D=void 0,this.C=t&&t.supportsCrossDomainXhr||!1,this.J="",this.b=new En(t&&t.concurrentRequestLimit),this.la=new jn,this.ea=t&&t.fastHandshake||!1,this.Ja=t&&t.b||!1,t&&t.f&&(this.c.a=!1),t&&t.forceLongPolling&&(this.S=!1),this.U=!this.ea&&this.S&&t&&t.detectBufferingProxy||!1,this.fa=void 0,this.N=0,this.F=!1,this.s=null,(this.La=t&&t.c||!1)&&this.c.info("Opt-in to enable Chrome Origin Trials.")}function Xn(t){if(Jn(t),3==t.v){var e=t.R++,n=tn(t.B);sn(n,"SID",t.J),sn(n,"RID",e),sn(n,"TYPE","terminate"),nr(t,n),(e=new Re(t,t.c,e,void 0)).G=2,e.i=an(tn(n)),n=!1,A.navigator&&A.navigator.sendBeacon&&(n=A.navigator.sendBeacon(e.i.toString(),"")),!n&&A.Image&&((new Image).src=e.i,n=!0),n||(e.a=pr(e.g,null),e.a.ba(e.i)),e.u=V(),Be(e)}fr(t)}function $n(t){t.a&&(sr(t),t.a.cancel(),t.a=null)}function Jn(t){$n(t),t.j&&(A.clearTimeout(t.j),t.j=null),ur(t),t.b.cancel(),t.h&&("number"==typeof t.h&&A.clearTimeout(t.h),t.h=null)}function Zn(t,e){t.g.push(new Tn(t.Pa++,e)),3==t.v&&tr(t)}function tr(t){On(t.b)||t.h||(t.h=!0,ee(t.Ca,t),t.u=0)}function er(t,e){var n;n=e?e.f:t.R++;var r=tn(t.B);sn(r,"SID",t.J),sn(r,"RID",n),sn(r,"AID",t.P),nr(t,r),t.i&&t.l&&Hn(r,t.i,t.l),n=new Re(t,t.c,n,t.u+1),null===t.i&&(n.B=t.l),e&&(t.g=e.s.concat(t.g)),e=rr(t,n,1e3),n.setTimeout(Math.round(.5*t.na)+Math.round(.5*t.na*Math.random())),Nn(t.b,n),Me(n,r,e)}function nr(t,e){t.f&&We({},function(t,n){sn(e,n,t)})}function rr(t,e,n){n=Math.min(t.g.length,n);var r=t.f?F(t.f.Ka,t.f,t):null;t:for(var i=t.g,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].b)):o=0:s.push("ofs="+o);for(var a=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),a=!1;else try{xn(h,s,"req"+c+"_")}catch($r){r&&r(h)}}if(a){r=s.join("&");break t}}return t=t.g.splice(0,n),e.s=t,r}function ir(t){t.a||t.j||(t.T=1,ee(t.Ba,t),t.o=0)}function or(t){return!(t.a||t.j||3<=t.o||(t.T++,t.j=_e(F(t.Ba,t),hr(t,t.o)),t.o++,0))}function sr(t){null!=t.s&&(A.clearTimeout(t.s),t.s=null)}function ar(t){t.a=new Re(t,t.c,"rpc",t.T),null===t.i&&(t.a.B=t.l),t.a.O=0;var e=tn(t.ma);sn(e,"RID","rpc"),sn(e,"SID",t.J),sn(e,"CI",t.G?"0":"1"),sn(e,"AID",t.P),nr(t,e),sn(e,"TYPE","xmlhttp"),t.i&&t.l&&Hn(e,t.i,t.l),t.D&&t.a.setTimeout(t.D);var n=t.a;t=t.ha,n.G=1,n.i=an(tn(e)),n.j=null,n.I=!0,Ve(n,t)}function ur(t){null!=t.m&&(A.clearTimeout(t.m),t.m=null)}function cr(t,e){var n=null;if(t.a==e){ur(t),sr(t),t.a=null;var r=2}else{if(!Dn(t.b,e))return;n=e.s,An(t.b,e),r=1}if(t.I=e.N,0!=t.v)if(e.b)if(1==r){n=e.j?e.j.length:0,e=V()-e.u;var i=t.u;Qt(r=me(),new Ee(r,n,e,i)),tr(t)}else ir(t);else if(3==(i=e.h)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Sn(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.g=e.s.concat(t.g),0):1==t.v||2==t.v||t.u>=(t.Ma?0:t.Na)||(t.h=_e(F(t.Ca,t,e),hr(t,t.u)),t.u++,0)))}(t,e)||2==r&&or(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:lr(t,5);break;case 4:lr(t,10);break;case 3:lr(t,6);break;default:lr(t,2)}}function hr(t,e){var n=t.Ia+Math.floor(Math.random()*t.Sa);return t.f||(n*=2),n*e}function lr(t,e){if(t.c.info("Error code "+e),2==e){var n=null;t.f&&(n=null);var r=F(t.cb,t);n||(n=new Ze("//www.google.com/images/cleardot.gif"),A.location&&"http"==A.location.protocol||en(n,"https"),an(n)),function(t,e){var n=new pe;if(A.Image){var r=new Image;r.onload=M(Rn,n,r,"TestLoadImage: loaded",!0,e),r.onerror=M(Rn,n,r,"TestLoadImage: error",!1,e),r.onabort=M(Rn,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=M(Rn,n,r,"TestLoadImage: timeout",!1,e),A.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else Te(2);t.v=0,t.f&&t.f.sa(e),fr(t),Jn(t)}function fr(t){t.v=0,t.I=-1,t.f&&(0==kn(t.b).length&&0==t.g.length||(t.b.c.length=0,z(t.g),t.g.length=0),t.f.ra())}function dr(t,e,n){var r=function(t){return t instanceof Ze?tn(t):new Ze(t,void 0)}(n);if(""!=r.c)e&&nn(r,e+"."+r.c),rn(r,r.h);else{var i=A.location;r=function(t,e,n,r){var i=new Ze(null,void 0);return t&&en(i,t),e&&nn(i,e),n&&rn(i,n),r&&(i.g=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.V&&Z(t.V,function(t,e){sn(r,e,t)}),n=t.oa,(e=t.A)&&n&&sn(r,e,n),sn(r,"VER",t.ia),nr(t,r),r}function pr(t,e){if(e&&!t.C)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ln(t.Oa)).G=t.C,e}function yr(){}function vr(){if(at&&!(10<=Number(mt)))throw Error("Environmental error: no available transport.")}function gr(t,e){zt.call(this),this.a=new Yn(e),this.g=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.l=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.a&&(t?t["X-WebChannel-Client-Profile"]=e.a:t={"X-WebChannel-Client-Profile":e.a}),this.a.O=t,(t=e&&e.httpHeadersOverwriteParam)&&!Q(t)&&(this.a.i=t),this.o=e&&e.supportsCrossDomainXhr||!1,this.m=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Q(e)&&(this.a.A=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new wr(this)}function mr(t){Ce.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function br(){je.call(this),this.status=1}function wr(t){this.a=t}function Ir(t){this.f=t}function Tr(t){zt.call(this),this.u=t,this.h=void 0,this.readyState=Er,this.status=0,this.responseType=this.responseText=this.statusText="",this.onreadystatechange=null,this.l=new Headers,this.b=null,this.s="GET",this.o="",this.a=!1,this.m=this.f=this.g=null}(S=Ln.prototype).ba=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.C+"; newUri="+t);e=e?e.toUpperCase():"GET",this.C=t,this.f="",this.h=0,this.A=!1,this.b=!0,this.a=this.l?this.l.a():Ae.a(),this.u=function(t){return t.b||(t.b=t.c())}(this.l?this.l:Ae),this.a.onreadystatechange=F(this.Aa,this);try{this.B=!0,this.a.open(e,String(t),!0),this.B=!1}catch(o){return void Un(this,o)}t=n||"";var i=new Ye(this.headers);r&&We(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=qn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.L()),n=A.FormData&&t instanceof A.FormData,!(0<=B(Vn,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.G&&(this.a.withCredentials=this.G);try{zn(this),0<this.s&&((this.F=function(t){return at&&gt(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.s,this.a.ontimeout=F(this.ya,this)):this.o=ae(this.ya,this.s,this)),this.m=!0,this.a.send(t),this.m=!1}catch(o){Un(this,o)}},S.ya=function(){void 0!==N&&this.a&&(this.f="Timed out after "+this.s+"ms, aborting",this.h=8,Qt(this,"timeout"),this.abort(8))},S.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,Qt(this,"complete"),Qt(this,"abort"),Gn(this))},S.H=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Gn(this,!0)),Ln.X.H.call(this)},S.Aa=function(){this.j||(this.B||this.m||this.g?Kn(this):this.Za())},S.Za=function(){Kn(this)},S.W=function(){try{return 2<Qn(this)?this.a.status:-1}catch(ot){return-1}},S.$=function(){try{return this.a?this.a.responseText:""}catch(ot){return""}},S.Qa=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Pn(e)}},S.va=function(){return this.h},S.Ra=function(){return"string"==typeof this.f?this.f:String(this.f)},(S=Yn.prototype).ia=8,S.v=1,S.Ca=function(t){if(this.h)if(this.h=null,1==this.v){if(!t){this.R=Math.floor(1e5*Math.random()),t=this.R++;var e,n=new Re(this,this.c,t,void 0),r=this.l;if(this.O&&(r?nt(r=tt(r),this.O):r=this.O),null===this.i&&(n.B=r),this.ea)t:{for(var i=e=0;i<this.g.length;i++){var o=this.g[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.g.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=rr(this,n,e),sn(i=tn(this.B),"RID",t),sn(i,"CVER",22),this.A&&sn(i,"X-HTTP-Session-Id",this.A),nr(this,i),this.i&&r&&Hn(i,this.i,r),Nn(this.b,n),this.Ja&&sn(i,"TYPE","init"),this.ea?(sn(i,"$req",e),sn(i,"SID","null"),n.U=!0,Me(n,i,null)):Me(n,i,e),this.v=2}}else 3==this.v&&(t?er(this,t):0==this.g.length||On(this.b)||er(this))},S.Ba=function(){if(this.j=null,ar(this),this.U&&!(this.F||null==this.a||0>=this.N)){var t=2*this.N;this.c.info("BP detection timer enabled: "+t),this.s=_e(F(this.Ya,this),t)}},S.Ya=function(){this.s&&(this.s=null,this.c.info("BP detection timeout reached."),this.c.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.F=!0,Te(10),$n(this),ar(this))},S.Xa=function(){null!=this.m&&(this.m=null,$n(this),or(this),Te(19))},S.cb=function(t){t?(this.c.info("Successfully pinged google.com"),Te(2)):(this.c.info("Failed to ping google.com"),Te(1))},(S=yr.prototype).ua=function(){},S.ta=function(){},S.sa=function(){},S.ra=function(){},S.Ka=function(){},vr.prototype.a=function(t,e){return new gr(t,e)},q(gr,zt),gr.prototype.h=function(){this.a.f=this.f,this.o&&(this.a.C=!0);var t=this.a,e=this.g,n=this.b||void 0;Te(0),t.ga=e,t.V=n||{},t.G=t.S,t.B=dr(t,null,t.ga),tr(t)},gr.prototype.close=function(){Xn(this.a)},gr.prototype.l=function(t){if("string"==typeof t){var e={};e.__data__=t,Zn(this.a,e)}else this.m?((e={}).__data__=Wt(t),Zn(this.a,e)):Zn(this.a,t)},gr.prototype.H=function(){this.a.f=null,delete this.f,Xn(this.a),delete this.a,gr.X.H.call(this)},q(mr,Ce),q(br,je),q(wr,yr),wr.prototype.ua=function(){Qt(this.a,"a")},wr.prototype.ta=function(t){Qt(this.a,new mr(t))},wr.prototype.sa=function(t){Qt(this.a,new br(t))},wr.prototype.ra=function(){Qt(this.a,"b")},q(Ir,De),Ir.prototype.a=function(){return new Tr(this.f)},Ir.prototype.c=function(t){return function(){return t}}({}),q(Tr,zt);var Er=0;function _r(t){t.f.read().then(t.Ta.bind(t)).catch(t.ca.bind(t))}function Or(t){t.readyState=4,t.g=null,t.f=null,t.m=null,Sr(t)}function Sr(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(S=Tr.prototype).open=function(t,e){if(this.readyState!=Er)throw this.abort(),Error("Error reopening a connection");this.s=t,this.o=e,this.readyState=1,Sr(this)},S.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.l,method:this.s,credentials:this.h,cache:void 0};t&&(e.body=t),this.u.fetch(new Request(this.o,e)).then(this.Wa.bind(this),this.ca.bind(this))},S.abort=function(){this.responseText="",this.l=new Headers,this.status=0,this.f&&this.f.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Or(this)),this.readyState=Er},S.Wa=function(t){this.a&&(this.g=t,this.b||(this.status=this.g.status,this.statusText=this.g.statusText,this.b=t.headers,this.readyState=2,Sr(this)),this.a&&(this.readyState=3,Sr(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.Ua.bind(this),this.ca.bind(this)):void 0!==A.ReadableStream&&"body"in t?(this.responseText="",this.f=t.body.getReader(),this.m=new TextDecoder,_r(this)):t.text().then(this.Va.bind(this),this.ca.bind(this)))))},S.Ta=function(t){if(this.a){var e=this.m.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.responseText+=e),t.done?Or(this):Sr(this),3==this.readyState&&_r(this)}},S.Va=function(t){this.a&&(this.responseText=t,Or(this))},S.Ua=function(){this.a&&Or(this)},S.ca=function(){this.a&&Or(this)},S.setRequestHeader=function(t,e){this.l.append(t,e)},S.getResponseHeader=function(t){return this.b&&this.b.get(t.toLowerCase())||""},S.getAllResponseHeaders=function(){if(!this.b)return"";for(var t=[],e=this.b.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(Tr.prototype,"withCredentials",{get:function(){return"include"===this.h},set:function(t){this.h=t?"include":"same-origin"}}),vr.prototype.createWebChannel=vr.prototype.a,gr.prototype.send=gr.prototype.l,gr.prototype.open=gr.prototype.h,gr.prototype.close=gr.prototype.close,Oe.NO_ERROR=0,Oe.TIMEOUT=8,Oe.HTTP_ERROR=6,Se.COMPLETE="complete",Ne.EventType=ke,ke.OPEN="a",ke.CLOSE="b",ke.ERROR="c",ke.MESSAGE="d",zt.prototype.listen=zt.prototype.wa,Ln.prototype.listenOnce=Ln.prototype.xa,Ln.prototype.getLastError=Ln.prototype.Ra,Ln.prototype.getLastErrorCode=Ln.prototype.va,Ln.prototype.getStatus=Ln.prototype.W,Ln.prototype.getResponseJson=Ln.prototype.Qa,Ln.prototype.getResponseText=Ln.prototype.$,Ln.prototype.send=Ln.prototype.ba;var Dr=Oe,Nr=Se,Ar=ve,kr=Ir,Cr=Ne,jr=Ln,xr=n("mrSG"),Rr=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Rr.o=-1;var Pr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Lr=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(xr.c)(e,t),e}(Error),Fr=new E.b("@firebase/firestore");function Mr(){return Fr.logLevel}function Vr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Fr.logLevel<=E.a.DEBUG){var r=e.map(Br);Fr.debug.apply(Fr,Object(xr.f)(["Firestore (8.6.7): "+t],r))}}function qr(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Fr.logLevel<=E.a.ERROR){var r=e.map(Br);Fr.error.apply(Fr,Object(xr.f)(["Firestore (8.6.7): "+t],r))}}function Ur(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Fr.logLevel<=E.a.WARN){var r=e.map(Br);Fr.warn.apply(Fr,Object(xr.f)(["Firestore (8.6.7): "+t],r))}}function Br(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(Bd){return t}}function Kr(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.6.7) INTERNAL ASSERTION FAILED: "+t;throw qr(e),new Error(e)}function Gr(t,e){t||Kr()}function zr(t,e){return t}function Qr(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var Hr=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Qr(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function Wr(t,e){return t<e?-1:t>e?1:0}function Yr(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function Xr(t){return t+"\0"}var $r=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Lr(Pr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Lr(Pr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Lr(Pr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Lr(Pr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?Wr(this.nanoseconds,t.nanoseconds):Wr(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),Jr=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new $r(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function Zr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ti(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ei(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var ni=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Kr(),void 0===n?n=t.length-e:n>t.length-e&&Kr(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),ri=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(xr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(ni),ii=/^[_a-zA-Z][_a-zA-Z0-9]*$/,oi=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(xr.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ii.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new Lr(Pr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Lr(Pr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new Lr(Pr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(ni),si=function(){function t(t){this.fields=t,t.sort(oi.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return Yr(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),ai=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return Wr(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();ai.EMPTY_BYTE_STRING=new ai("");var ui=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ci(t){if(Gr(!!t),"string"==typeof t){var e=0,n=ui.exec(t);if(Gr(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:hi(t.seconds),nanos:hi(t.nanos)}}function hi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function li(t){return"string"==typeof t?ai.fromBase64String(t):ai.fromUint8Array(t)}function fi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function di(t){var e=t.mapValue.fields.__previous_value__;return fi(e)?di(e):e}function pi(t){var e=ci(t.mapValue.fields.__local_write_time__.timestampValue);return new $r(e.seconds,e.nanos)}function yi(t){return null==t}function vi(t){return 0===t&&1/t==-1/0}function gi(t){return"number"==typeof t&&Number.isInteger(t)&&!vi(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var mi=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(ri.fromString(e))},t.fromName=function(e){return new t(ri.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===ri.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return ri.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new ri(e.slice()))},t}();function bi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?fi(t)?4:10:Kr()}function wi(t,e){var n=bi(t);if(n!==bi(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return pi(t).isEqual(pi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=ci(t.timestampValue),r=ci(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return li(t.bytesValue).isEqual(li(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return hi(t.geoPointValue.latitude)===hi(e.geoPointValue.latitude)&&hi(t.geoPointValue.longitude)===hi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return hi(t.integerValue)===hi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=hi(t.doubleValue),r=hi(e.doubleValue);return n===r?vi(n)===vi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Yr(t.arrayValue.values||[],e.arrayValue.values||[],wi);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Zr(n)!==Zr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!wi(n[i],r[i])))return!1;return!0}(t,e);default:return Kr()}}function Ii(t,e){return void 0!==(t.values||[]).find(function(t){return wi(t,e)})}function Ti(t,e){var n=bi(t),r=bi(e);if(n!==r)return Wr(n,r);switch(n){case 0:return 0;case 1:return Wr(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=hi(t.integerValue||t.doubleValue),r=hi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Ei(t.timestampValue,e.timestampValue);case 4:return Ei(pi(t),pi(e));case 5:return Wr(t.stringValue,e.stringValue);case 6:return function(t,e){var n=li(t),r=li(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=Wr(n[i],r[i]);if(0!==o)return o}return Wr(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=Wr(hi(t.latitude),hi(e.latitude));return 0!==n?n:Wr(hi(t.longitude),hi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ti(n[i],r[i]);if(o)return o}return Wr(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=Wr(r[s],o[s]);if(0!==a)return a;var u=Ti(n[r[s]],i[o[s]]);if(0!==u)return u}return Wr(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Kr()}}function Ei(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Wr(t,e);var n=ci(t),r=ci(e),i=Wr(n.seconds,r.seconds);return 0!==i?i:Wr(n.nanos,r.nanos)}function _i(t){return Oi(t)}function Oi(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=ci(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?li(t.bytesValue).toBase64():"referenceValue"in t?mi.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Oi(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Oi(t.fields[o])}return e+"}"}(t.mapValue):Kr();var e}function Si(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Di(t){return!!t&&"integerValue"in t}function Ni(t){return!!t&&"arrayValue"in t}function Ai(t){return!!t&&"nullValue"in t}function ki(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ci(t){return!!t&&"mapValue"in t}function ji(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue)return{timestampValue:Object.assign({},ci(t.timestampValue))};if(t.mapValue){var e={mapValue:{fields:{}}};return ti(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=ji(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=ji(t.arrayValue.values[r]);return n}return Object.assign({},t)}var xi=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!Ci(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ji(e)},t.prototype.setAll=function(t){var e=this,n=oi.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=ji(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());Ci(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return wi(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];Ci(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){ti(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(ji(this.value))},t}();function Ri(t){var e=[];return ti(t.fields,function(t,n){var r=new oi([t]);if(Ci(n)){var i=Ri(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new si(e)}var Pi=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,Jr.min(),xi.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,xi.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,xi.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=xi.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=xi.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),Li=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Fi(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new Li(t,e,n,r,i,o,s)}function Mi(t){var e=zr(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+_i(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),yi(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=$i(e.startAt)),e.endAt&&(n+="|ub:",n+=$i(e.endAt)),e.h=n}return e.h}function Vi(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!Zi(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!wi(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!eo(t.startAt,e.startAt)&&eo(t.endAt,e.endAt)}function qi(t){return mi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Ui=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(xr.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Bi(t,n,r):"array-contains"===n?new Qi(t,r):"in"===n?new Hi(t,r):"not-in"===n?new Wi(t,r):"array-contains-any"===n?new Yi(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Ki(t,n):new Gi(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Ti(e,this.value)):null!==e&&bi(this.value)===bi(e)&&this.m(Ti(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Kr()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Bi=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=mi.fromName(r.referenceValue),i}return Object(xr.c)(e,t),e.prototype.matches=function(t){var e=mi.comparator(t.key,this.key);return this.m(e)},e}(Ui),Ki=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=zi(0,n),r}return Object(xr.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Ui),Gi=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=zi(0,n),r}return Object(xr.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Ui);function zi(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return mi.fromName(t.referenceValue)})}var Qi=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(xr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Ni(e)&&Ii(e.arrayValue,this.value)},e}(Ui),Hi=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(xr.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&Ii(this.value.arrayValue,e)},e}(Ui),Wi=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(xr.c)(e,t),e.prototype.matches=function(t){if(Ii(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!Ii(this.value.arrayValue,e)},e}(Ui),Yi=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(xr.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Ni(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return Ii(e.value.arrayValue,t)})},e}(Ui),Xi=function(t,e){this.position=t,this.before=e};function $i(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return _i(t)}).join(",")}var Ji=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function Zi(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function to(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?mi.comparator(mi.fromName(s.referenceValue),n.key):Ti(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function eo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!wi(t.position[n],e.position[n]))return!1;return!0}var no=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function ro(t,e,n,r,i,o,s,a){return new no(t,e,n,r,i,o,s,a)}function io(t){return new no(t)}function oo(t){return!yi(t.limit)&&"F"===t.limitType}function so(t){return!yi(t.limit)&&"L"===t.limitType}function ao(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function uo(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function co(t){return null!==t.collectionGroup}function ho(t){var e=zr(t);if(null===e.p){e.p=[];var n=uo(e),r=ao(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new Ji(n)),e.p.push(new Ji(oi.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var u=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new Ji(oi.keyField(),u))}}}return e.p}function lo(t){var e=zr(t);if(!e.T)if("F"===e.limitType)e.T=Fi(e.path,e.collectionGroup,ho(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=ho(e);r<i.length;r++){var o=i[r];n.push(new Ji(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new Xi(e.endAt.position,!e.endAt.before):null,a=e.startAt?new Xi(e.startAt.position,!e.startAt.before):null;e.T=Fi(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function fo(t,e,n){return new no(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function po(t,e){return Vi(lo(t),lo(e))&&t.limitType===e.limitType}function yo(t){return Mi(lo(t))+"|lt:"+t.limitType}function vo(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+_i(e.value);var e}).join(", ")+"]"),yi(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+$i(t.startAt)),t.endAt&&(e+=", endAt: "+$i(t.endAt)),"Target("+e+")"}(lo(t))+"; limitType="+t.limitType+")"}function go(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):mi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!to(t.startAt,ho(t),e)||t.endAt&&to(t.endAt,ho(t),e))}(t,e)}function mo(t){return function(e,n){for(var r=!1,i=0,o=ho(t);i<o.length;i++){var s=o[i],a=bo(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function bo(t,e,n){var r=t.field.isKeyField()?mi.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Ti(r,i):Kr()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Kr()}}function wo(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:vi(e)?"-0":e}}function Io(t){return{integerValue:""+t}}function To(t,e){return gi(e)?Io(e):wo(t,e)}var Eo=function(){this._=void 0};function _o(t,e,n){return t instanceof Do?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof No?Ao(t,e):t instanceof ko?Co(t,e):function(t,e){var n=So(t,e),r=xo(n)+xo(t.A);return Di(n)&&Di(t.A)?Io(r):wo(t.R,r)}(t,e)}function Oo(t,e,n){return t instanceof No?Ao(t,e):t instanceof ko?Co(t,e):n}function So(t,e){return t instanceof jo?Di(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Do=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(xr.c)(e,t),e}(Eo),No=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(xr.c)(e,t),e}(Eo);function Ao(t,e){for(var n=Ro(e),r=function(t){n.some(function(e){return wi(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var ko=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(xr.c)(e,t),e}(Eo);function Co(t,e){for(var n=Ro(e),r=function(t){n=n.filter(function(e){return!wi(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var jo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(xr.c)(e,t),e}(Eo);function xo(t){return hi(t.integerValue||t.doubleValue)}function Ro(t){return Ni(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Po=function(t,e){this.field=t,this.transform=e},Lo=function(t,e){this.version=t,this.transformResults=e},Fo=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Mo(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var Vo=function(){};function qo(t,e,n){t instanceof zo?function(t,e,n){var r=t.value.clone(),i=Wo(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Qo?function(t,e,n){if(Mo(t.precondition,e)){var r=Wo(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Ho(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Uo(t,e,n){t instanceof zo?function(t,e,n){if(Mo(t.precondition,e)){var r=t.value.clone(),i=Yo(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Go(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Qo?function(t,e,n){if(Mo(t.precondition,e)){var r=Yo(t.fieldTransforms,n,e),i=e.data;i.setAll(Ho(t)),i.setAll(r),e.convertToFoundDocument(Go(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Mo(t.precondition,e)&&e.convertToNoDocument(Jr.min())}(t,e)}function Bo(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=So(o.transform,s||null);null!=a&&(null==n&&(n=xi.empty()),n.set(o.field,a))}return n||null}function Ko(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Yr(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof No&&e instanceof No||t instanceof ko&&e instanceof ko?Yr(t.elements,e.elements,wi):t instanceof jo&&e instanceof jo?wi(t.A,e.A):t instanceof Do&&e instanceof Do}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Go(t){return t.isFoundDocument()?t.version:Jr.min()}var zo=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(xr.c)(e,t),e}(Vo),Qo=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(xr.c)(e,t),e}(Vo);function Ho(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function Wo(t,e,n){var r=new Map;Gr(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Oo(s,a,n[i]))}return r}function Yo(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,u=n.data.field(s.field);r.set(s.field,_o(a,u,e))}return r}var Xo,$o,Jo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(xr.c)(e,t),e}(Vo),Zo=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(xr.c)(e,t),e}(Vo),ts=function(t){this.count=t};function es(t){switch(t){case Pr.OK:return Kr();case Pr.CANCELLED:case Pr.UNKNOWN:case Pr.DEADLINE_EXCEEDED:case Pr.RESOURCE_EXHAUSTED:case Pr.INTERNAL:case Pr.UNAVAILABLE:case Pr.UNAUTHENTICATED:return!1;case Pr.INVALID_ARGUMENT:case Pr.NOT_FOUND:case Pr.ALREADY_EXISTS:case Pr.PERMISSION_DENIED:case Pr.FAILED_PRECONDITION:case Pr.ABORTED:case Pr.OUT_OF_RANGE:case Pr.UNIMPLEMENTED:case Pr.DATA_LOSS:return!0;default:return Kr()}}function ns(t){if(void 0===t)return qr("GRPC error has no .code"),Pr.UNKNOWN;switch(t){case Xo.OK:return Pr.OK;case Xo.CANCELLED:return Pr.CANCELLED;case Xo.UNKNOWN:return Pr.UNKNOWN;case Xo.DEADLINE_EXCEEDED:return Pr.DEADLINE_EXCEEDED;case Xo.RESOURCE_EXHAUSTED:return Pr.RESOURCE_EXHAUSTED;case Xo.INTERNAL:return Pr.INTERNAL;case Xo.UNAVAILABLE:return Pr.UNAVAILABLE;case Xo.UNAUTHENTICATED:return Pr.UNAUTHENTICATED;case Xo.INVALID_ARGUMENT:return Pr.INVALID_ARGUMENT;case Xo.NOT_FOUND:return Pr.NOT_FOUND;case Xo.ALREADY_EXISTS:return Pr.ALREADY_EXISTS;case Xo.PERMISSION_DENIED:return Pr.PERMISSION_DENIED;case Xo.FAILED_PRECONDITION:return Pr.FAILED_PRECONDITION;case Xo.ABORTED:return Pr.ABORTED;case Xo.OUT_OF_RANGE:return Pr.OUT_OF_RANGE;case Xo.UNIMPLEMENTED:return Pr.UNIMPLEMENTED;case Xo.DATA_LOSS:return Pr.DATA_LOSS;default:return Kr()}}($o=Xo||(Xo={}))[$o.OK=0]="OK",$o[$o.CANCELLED=1]="CANCELLED",$o[$o.UNKNOWN=2]="UNKNOWN",$o[$o.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",$o[$o.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",$o[$o.NOT_FOUND=5]="NOT_FOUND",$o[$o.ALREADY_EXISTS=6]="ALREADY_EXISTS",$o[$o.PERMISSION_DENIED=7]="PERMISSION_DENIED",$o[$o.UNAUTHENTICATED=16]="UNAUTHENTICATED",$o[$o.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",$o[$o.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",$o[$o.ABORTED=10]="ABORTED",$o[$o.OUT_OF_RANGE=11]="OUT_OF_RANGE",$o[$o.UNIMPLEMENTED=12]="UNIMPLEMENTED",$o[$o.INTERNAL=13]="INTERNAL",$o[$o.UNAVAILABLE=14]="UNAVAILABLE",$o[$o.DATA_LOSS=15]="DATA_LOSS";var rs=function(){function t(t,e){this.comparator=t,this.root=e||os.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,os.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,os.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new is(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new is(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new is(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new is(this.root,t,this.comparator,!0)},t}(),is=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),os=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Kr();if(this.right.isRed())throw Kr();var t=this.left.check();if(t!==this.right.check())throw Kr();return t+(this.isRed()?0:1)},t}();os.EMPTY=null,os.RED=!0,os.BLACK=!1,os.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Kr()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new os(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var ss=function(){function t(t){this.comparator=t,this.data=new rs(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new as(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new as(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),as=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),us=new rs(mi.comparator);function cs(){return us}var hs=new rs(mi.comparator);function ls(){return hs}var fs=new rs(mi.comparator);function ds(){return fs}var ps=new ss(mi.comparator);function ys(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=ps,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var vs=new ss(Wr);function gs(){return vs}var ms=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,bs.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(Jr.min(),r,gs(),cs(),ys())},t}(),bs=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(ai.EMPTY_BYTE_STRING,n,ys(),ys(),ys())},t}(),ws=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Is=function(t,e){this.targetId=t,this.V=e},Ts=function(t,e,n,r){void 0===n&&(n=ai.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Es=function(){function t(){this.S=0,this.D=Ss(),this.C=ai.EMPTY_BYTE_STRING,this.N=!1,this.F=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"k",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.F},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.F=!0,this.C=t)},t.prototype.M=function(){var t=ys(),e=ys(),n=ys();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Kr()}}),new bs(this.C,this.N,t,e,n)},t.prototype.L=function(){this.F=!1,this.D=Ss()},t.prototype.B=function(t,e){this.F=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.F=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.F=!0,this.N=!0},t}(),_s=function(){function t(t){this.W=t,this.G=new Map,this.H=cs(),this.J=Os(),this.Y=new ss(Wr)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.k||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.k||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Kr()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(qi(i))if(0===n){var o=new mi(i.path);this.tt(e,o,Pi.newNoDocument(o,Jr.min()))}else Gr(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&qi(o.target)){var s=new mi(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Pi.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=ys();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new ms(t,n,this.Y,this.H,r);return this.H=cs(),this.J=Os(),this.Y=new ss(Wr),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Es,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new ss(Wr),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Vr("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.k?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Es),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Os(){return new rs(mi.comparator)}function Ss(){return new rs(mi.comparator)}var Ds={asc:"ASCENDING",desc:"DESCENDING"},Ns={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},As=function(t,e){this.databaseId=t,this.I=e};function ks(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function Cs(t,e){return t.I?e.toBase64():e.toUint8Array()}function js(t,e){return ks(t,e.toTimestamp())}function xs(t){return Gr(!!t),Jr.fromTimestamp(function(t){var e=ci(t);return new $r(e.seconds,e.nanos)}(t))}function Rs(t,e){return function(t){return new ri(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Ps(t){var e=ri.fromString(t);return Gr(oa(e)),e}function Ls(t,e){return Rs(t.databaseId,e.path)}function Fs(t,e){var n=Ps(e);if(n.get(1)!==t.databaseId.projectId)throw new Lr(Pr.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Lr(Pr.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new mi(Us(n))}function Ms(t,e){return Rs(t.databaseId,e)}function Vs(t){var e=Ps(t);return 4===e.length?ri.emptyPath():Us(e)}function qs(t){return new ri(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Us(t){return Gr(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Bs(t,e,n){return{name:Ls(t,e),fields:n.value.mapValue.fields}}function Ks(t,e,n){var r=Fs(t,e.name),i=xs(e.updateTime),o=new xi({mapValue:{fields:e.fields}}),s=Pi.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Gs(t,e){var n;if(e instanceof zo)n={update:Bs(t,e.key,e.value)};else if(e instanceof Jo)n={delete:Ls(t,e.key)};else if(e instanceof Qo)n={update:Bs(t,e.key,e.data),updateMask:ia(e.fieldMask)};else{if(!(e instanceof Zo))return Kr();n={verify:Ls(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Do)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof No)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof ko)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof jo)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Kr()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:js(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Kr()}(t,e.precondition)),n}function zs(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?Fo.updateTime(xs(t.updateTime)):void 0!==t.exists?Fo.exists(t.exists):Fo.none()}(e.currentDocument):Fo.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Gr("REQUEST_TIME"===e.setToServerValue),n=new Do):"appendMissingElements"in e?n=new No(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new ko(e.removeAllFromArray.values||[]):"increment"in e?n=new jo(t,e.increment):Kr();var r=oi.fromServerFormat(e.fieldPath);return new Po(r,n)}(t,e)}):[];if(e.update){var i=Fs(t,e.update.name),o=new xi({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new si((t.fieldPaths||[]).map(function(t){return oi.fromServerFormat(t)}))}(e.updateMask);return new Qo(i,o,s,n,r)}return new zo(i,o,n,r)}if(e.delete){var a=Fs(t,e.delete);return new Jo(a,n)}if(e.verify){var u=Fs(t,e.verify);return new Zo(u,n)}return Kr()}function Qs(t,e){return{documents:[Ms(t,e.path)]}}function Hs(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Ms(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Ms(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(ki(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NAN"}};if(Ai(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ki(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NOT_NAN"}};if(Ai(t.value))return{unaryFilter:{field:ta(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ta(t.field),op:Zs(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:ta(t.field),direction:Js(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||yi(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=Xs(e.startAt)),e.endAt&&(n.structuredQuery.endAt=Xs(e.endAt)),n}function Ws(t){var e=Vs(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Gr(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=Ys(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new Ji(ea(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var u=null;n.limit&&(u=function(t){var e;return yi(e="object"==typeof t?t.value:t)?null:e}(n.limit));var c=null;n.startAt&&(c=$s(n.startAt));var h=null;return n.endAt&&(h=$s(n.endAt)),ro(e,i,a,s,u,"F",c,h)}function Ys(t){return t?void 0!==t.unaryFilter?[ra(t)]:void 0!==t.fieldFilter?[na(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return Ys(t)}).reduce(function(t,e){return t.concat(e)}):Kr():[]}function Xs(t){return{before:t.before,values:t.position}}function $s(t){return new Xi(t.values||[],!!t.before)}function Js(t){return Ds[t]}function Zs(t){return Ns[t]}function ta(t){return{fieldPath:t.canonicalString()}}function ea(t){return oi.fromServerFormat(t.fieldPath)}function na(t){return Ui.create(ea(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Kr()}}(t.fieldFilter.op),t.fieldFilter.value)}function ra(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ea(t.unaryFilter.field);return Ui.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ea(t.unaryFilter.field);return Ui.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ea(t.unaryFilter.field);return Ui.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ea(t.unaryFilter.field);return Ui.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Kr()}}function ia(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function oa(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function sa(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=ua(e)),e=aa(t.get(n),e);return ua(e)}function aa(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function ua(t){return t+"\x01\x01"}function ca(t){var e=t.length;if(Gr(e>=2),2===e)return Gr("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),ri.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Kr(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),u=void 0;0===i.length?u=a:(u=i+=a,i=""),r.push(u);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Kr()}o=s+2}return new ri(r)}var ha=function(t,e){this.seconds=t,this.nanoseconds=e},la=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};la.store="owner",la.key="owner";var fa=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};fa.store="mutationQueues",fa.keyPath="userId";var da=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};da.store="mutations",da.keyPath="batchId",da.userMutationsIndex="userMutationsIndex",da.userMutationsKeyPath=["userId","batchId"];var pa=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,sa(e)]},t.key=function(t,e,n){return[t,sa(e),n]},t}();pa.store="documentMutations",pa.PLACEHOLDER=new pa;var ya=function(t,e){this.path=t,this.readTime=e},va=function(t,e){this.path=t,this.version=e},ga=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};ga.store="remoteDocuments",ga.readTimeIndex="readTimeIndex",ga.readTimeIndexPath="readTime",ga.collectionReadTimeIndex="collectionReadTimeIndex",ga.collectionReadTimeIndexPath=["parentPath","readTime"];var ma=function(t){this.byteSize=t};ma.store="remoteDocumentGlobal",ma.key="remoteDocumentGlobalKey";var ba=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};ba.store="targets",ba.keyPath="targetId",ba.queryTargetsIndexName="queryTargetsIndex",ba.queryTargetsKeyPath=["canonicalId","targetId"];var wa=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};wa.store="targetDocuments",wa.keyPath=["targetId","path"],wa.documentTargetsIndex="documentTargetsIndex",wa.documentTargetsKeyPath=["path","targetId"];var Ia=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ia.key="targetGlobalKey",Ia.store="targetGlobal";var Ta=function(t,e){this.collectionId=t,this.parent=e};Ta.store="collectionParents",Ta.keyPath=["collectionId","parent"];var Ea=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ea.store="clientMetadata",Ea.keyPath="clientId";var _a=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};_a.store="bundles",_a.keyPath="bundleId";var Oa=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Oa.store="namedQueries",Oa.keyPath="name";var Sa=Object(xr.f)(Object(xr.f)([],Object(xr.f)(Object(xr.f)([],Object(xr.f)(Object(xr.f)([],Object(xr.f)(Object(xr.f)([],[fa.store,da.store,pa.store,ga.store,ba.store,la.store,Ia.store,wa.store]),[Ea.store])),[ma.store])),[Ta.store])),[_a.store,Oa.store]),Da="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Na=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Aa=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},ka=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Kr(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),Ca=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Aa,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Ra(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=Va(e.target.error);n.ft.reject(new Ra(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Ra(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Vr("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new La(e)},t}(),ja=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(T.p)())&&qr("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Vr("SimpleDb","Removing database:",t),Fa(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(T.p)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(xr.b)(this,void 0,void 0,function(){var e,n=this;return Object(xr.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Vr("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Ra(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new Lr(Pr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Ra(t,n))},i.onupgradeneeded=function(t){Vr("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Vr("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(xr.b)(this,void 0,void 0,function(){var i,o,s,a,u;return Object(xr.d)(this,function(c){switch(c.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,u,c,h;return Object(xr.d)(this,function(l){switch(l.label){case 0:++o,l.label=1;case 1:return l.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=l.sent(),e=Ca.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),ka.reject(t)}).toPromise(),u={},s.catch(function(){}),[4,e.dt];case 3:return[2,(u.value=(l.sent(),s),u)];case 4:return Vr("SimpleDb","Transaction failed with error:",(c=l.sent()).message,"Retrying:",h="FirebaseError"!==c.name&&o<3),a.close(),h?[3,5]:[2,{value:Promise.reject(c)}];case 5:return[2]}})},a=this,c.label=1;case 1:return[5,s()];case 2:if("object"==typeof(u=c.sent()))return[2,u.value];c.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),xa=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return Fa(this.Pt.delete())},t}(),Ra=function(t){function e(e,n){var r=this;return(r=t.call(this,Pr.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(xr.c)(e,t),e}(Lr);function Pa(t){return"IndexedDbTransactionError"===t.name}var La=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Vr("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Vr("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Fa(n)},t.prototype.add=function(t){return Vr("SimpleDb","ADD",this.store.name,t,t),Fa(this.store.add(t))},t.prototype.get=function(t){var e=this;return Fa(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Vr("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Vr("SimpleDb","DELETE",this.store.name,t),Fa(this.store.delete(t))},t.prototype.count=function(){return Vr("SimpleDb","COUNT",this.store.name),Fa(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.Ft=function(t,e){Vr("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.kt=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new ka(function(n,r){e.onerror=function(t){var e=Va(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new ka(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new xa(i),s=e(i.primaryKey,i.value,o);if(s instanceof ka){var a=s.catch(function(t){return o.done(),ka.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return ka.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.kt?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function Fa(t){return new ka(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=Va(t.target.error);n(e)}})}var Ma=!1;function Va(t){var e=ja._t(Object(T.p)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Lr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Ma||(Ma=!0,setTimeout(function(){throw r},0)),r}}return t}var qa=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(xr.c)(e,t),e}(Na);function Ua(t,e){var n=zr(t);return ja.It(n.Mt,e)}var Ba=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&qo(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Uo(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Uo(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(Jr.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},ys())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&Yr(this.mutations,t.mutations,function(t,e){return Ko(t,e)})&&Yr(this.baseMutations,t.baseMutations,function(t,e){return Ko(t,e)})},t}(),Ka=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Gr(e.mutations.length===r.length);for(var i=ds(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Ga=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=Jr.min()),void 0===o&&(o=Jr.min()),void 0===s&&(s=ai.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),za=function(t){this.Lt=t};function Qa(t,e){if(e.document)return Ks(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=mi.fromSegments(e.noDocument.path),r=$a(e.noDocument.readTime),i=Pi.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=mi.fromSegments(e.unknownDocument.path);return r=$a(e.unknownDocument.version),Pi.newUnknownDocument(o,r)}return Kr()}function Ha(t,e,n){var r=Wa(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Ls(t,e.key),fields:e.data.value.mapValue.fields,updateTime:ks(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new ga(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),u=Xa(e.version);return s=e.hasCommittedMutations,new ga(null,new ya(a,u),null,s,r,i)}if(e.isUnknownDocument()){var c=e.key.path.toArray(),h=Xa(e.version);return new ga(new va(c,h),null,null,!0,r,i)}return Kr()}function Wa(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function Ya(t){var e=new $r(t[0],t[1]);return Jr.fromTimestamp(e)}function Xa(t){var e=t.toTimestamp();return new ha(e.seconds,e.nanoseconds)}function $a(t){var e=new $r(t.seconds,t.nanoseconds);return Jr.fromTimestamp(e)}function Ja(t,e){for(var n=(e.baseMutations||[]).map(function(e){return zs(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return zs(t.Lt,e)}),o=$r.fromMillis(e.localWriteTimeMs);return new Ba(e.batchId,o,n,i)}function Za(t){var e,n,r=$a(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?$a(t.lastLimboFreeSnapshotVersion):Jr.min();return void 0!==t.query.documents?(Gr(1===(n=t.query).documents.length),e=lo(io(Vs(n.documents[0])))):e=function(t){return lo(Ws(t))}(t.query),new Ga(e,t.targetId,0,t.lastListenSequenceNumber,r,i,ai.fromBase64String(t.resumeToken))}function tu(t,e){var n,r=Xa(e.snapshotVersion),i=Xa(e.lastLimboFreeSnapshotVersion);n=qi(e.target)?Qs(t.Lt,e.target):Hs(t.Lt,e.target);var o=e.resumeToken.toBase64();return new ba(e.targetId,Mi(e.target),r,o,e.sequenceNumber,i,n)}function eu(t){var e=Ws({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?fo(e,e.limit,"L"):e}var nu=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return ru(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:$a(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return ru(t).put({bundleId:(n=e).id,createTime:Xa(xs(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return iu(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:eu(e.bundledQuery),readTime:$a(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return iu(t).put(function(t){return{name:t.name,readTime:Xa(xs(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function ru(t){return Ua(t,_a.store)}function iu(t){return Ua(t,Oa.store)}var ou=function(){function t(){this.Bt=new su}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),ka.resolve()},t.prototype.getCollectionParents=function(t,e){return ka.resolve(this.Bt.getEntries(e))},t}(),su=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new ss(ri.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new ss(ri.comparator)).toArray()},t}(),au=function(){function t(){this.qt=new su}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:sa(i)};return uu(t).put(o)}return ka.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[Xr(e),""],!1,!0);return uu(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(ca(o.parent))}return n})},t}();function uu(t){return Ua(t,Ta.store)}var cu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},hu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function lu(t,e,n){var r=t.store(da.store),i=t.store(pa.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,u=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(u.next(function(){Gr(1===a)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],d=pa.key(e,f.key.path,n.batchId);o.push(i.delete(d)),c.push(f.key)}return ka.waitFor(o).next(function(){return c})}function fu(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Kr();e=t.noDocument}return JSON.stringify(e).length}hu.DEFAULT_COLLECTION_PERCENTILE=10,hu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,hu.DEFAULT=new hu(41943040,hu.DEFAULT_COLLECTION_PERCENTILE,hu.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),hu.DISABLED=new hu(-1,0,0);var du=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Qt={}}return t.Kt=function(e,n,r,i){return Gr(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return yu(t).$t({index:da.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=vu(t),s=yu(t);return s.add({}).next(function(a){Gr("number"==typeof a);for(var u=new Ba(a,e,n,r),c=function(t,e,n){var r=n.baseMutations.map(function(e){return Gs(t.Lt,e)}),i=n.mutations.map(function(e){return Gs(t.Lt,e)});return new da(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,u),h=[],l=new ss(function(t,e){return Wr(t.canonicalString(),e.canonicalString())}),f=0,d=r;f<d.length;f++){var p=d[f],y=pa.key(i.userId,p.key.path,a);l=l.add(p.key.path.popLast()),h.push(s.put(c)),h.push(o.put(y,pa.PLACEHOLDER))}return l.forEach(function(e){h.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Qt[a]=u.keys()}),ka.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return yu(t).get(e).next(function(t){return t?(Gr(t.userId===n.userId),Ja(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Qt[e]?ka.resolve(this.Qt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Qt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return yu(t).$t({index:da.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Gr(e.batchId>=r),o=Ja(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return yu(t).$t({index:da.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return yu(t).Nt(da.userMutationsIndex,n).next(function(t){return t.map(function(t){return Ja(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=pa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return vu(t).$t({range:i},function(r,i,s){var a=r[0],u=r[2],c=ca(r[1]);if(a===n.userId&&e.path.isEqual(c))return yu(t).get(u).next(function(t){if(!t)throw Kr();Gr(t.userId===n.userId),o.push(Ja(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ss(Wr),i=[];return e.forEach(function(e){var o=pa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=vu(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],u=ca(t[1]);s===n.userId&&e.path.isEqual(u)?r=r.add(a):o.done()});i.push(a)}),ka.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=pa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new ss(Wr);return vu(t).$t({range:s},function(t,e,o){var s=t[0],u=t[2],c=ca(t[1]);s===n.userId&&r.isPrefixOf(c)?c.length===i&&(a=a.add(u)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(yu(t).get(e).next(function(t){if(null===t)throw Kr();Gr(t.userId===n.userId),r.push(Ja(n.R,t))}))}),ka.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return lu(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),ka.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Qt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return ka.resolve();var r=IDBKeyRange.lowerBound(pa.prefixForUser(e.userId)),i=[];return vu(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=ca(t[1]);i.push(o)}else r.done()}).next(function(){Gr(0===i.length)})})},t.prototype.containsKey=function(t,e){return pu(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return gu(t).get(this.userId).next(function(t){return t||new fa(e.userId,-1,"")})},t}();function pu(t,e,n){var r=pa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return vu(t).$t({range:o,kt:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function yu(t){return Ua(t,da.store)}function vu(t){return Ua(t,pa.store)}function gu(t){return Ua(t,fa.store)}var mu=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),bu=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new mu(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return Jr.fromTimestamp(new $r(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return wu(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Gr(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return wu(t).$t(function(s,a){var u=Za(a);u.sequenceNumber<=e&&null===n.get(u.targetId)&&(i++,o.push(r.removeTargetData(t,u)))}).next(function(){return ka.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return wu(t).$t(function(t,n){var r=Za(n);e(r)})},t.prototype.Xt=function(t){return Iu(t).get(Ia.key).next(function(t){return Gr(null!==t),t})},t.prototype.Zt=function(t,e){return Iu(t).put(Ia.key,e)},t.prototype.te=function(t,e){return wu(t).put(tu(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=Mi(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return wu(t).$t({range:r,index:ba.queryTargetsIndexName},function(t,n,r){var o=Za(n);Vi(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Tu(t);return e.forEach(function(e){var s=sa(e.path);i.push(o.put(new wa(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),ka.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Tu(t);return ka.forEach(e,function(e){var o=sa(e.path);return ka.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Tu(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Tu(t),i=ys();return r.$t({range:n,kt:!0},function(t,e,n){var r=ca(t[1]),o=new mi(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=sa(e.path),r=IDBKeyRange.bound([n],[Xr(n)],!1,!0),i=0;return Tu(t).$t({index:wa.documentTargetsIndex,kt:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return wu(t).get(e).next(function(t){return t?Za(t):null})},t}();function wu(t){return Ua(t,ba.store)}function Iu(t){return Ua(t,Ia.store)}function Tu(t){return Ua(t,wa.store)}function Eu(t){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(e){if(t.code!==Pr.FAILED_PRECONDITION||t.message!==Da)throw t;return Vr("LocalStore","Unexpectedly lost primary lease"),[2]})})}function _u(t,e){var n=t[1],r=e[1],i=Wr(t[0],e[0]);return 0===i?Wr(n,r):i}var Ou=function(){function t(t){this.ne=t,this.buffer=new ss(_u),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();_u(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Su=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Vr("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(xr.b)(e,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Pa(e=n.sent())?(Vr("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Eu(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Du=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ka.resolve(Rr.o);var r=new Ou(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector","Garbage collection skipped; disabled"),ka.resolve(cu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Vr("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),cu):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(Vr("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){return u=Date.now(),Mr()<=E.a.DEBUG&&Vr("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(u-a)+"ms\nTotal Duration: "+(u-h)+"ms"),ka.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Nu=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Du(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Au(t,n)},t.prototype.removeReference=function(t,e,n){return Au(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Au(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return gu(t).Ot(function(r){return pu(t,r,e).next(function(t){return t&&(n=!0),ka.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var u=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),Tu(t).delete([0,sa(s.path)])})});i.push(u)}}).next(function(){return ka.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Au(t,e)},t.prototype.we=function(t,e){var n,r=Tu(t),i=Rr.o;return r.$t({index:wa.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Rr.o&&e(new mi(ca(n)),i),i=s,n=o):i=Rr.o}).next(function(){i!==Rr.o&&e(new mi(ca(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Au(t,e){return Tu(t).put(function(t,e){return new wa(0,sa(t.path),e)}(e,t.currentSequenceNumber))}var ku=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){ti(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return ei(this.inner)},t}(),Cu=function(){function t(){this.changes=new ku(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:Jr.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Pi.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ka.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),ju=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Pu(t).put(Lu(e),n)},t.prototype.removeEntry=function(t,e){var n=Pu(t),r=Lu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Pu(t).get(Lu(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Pu(t).get(Lu(e)).next(function(t){return{document:n.ye(e,t),size:fu(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=cs();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=cs(),i=new rs(mi.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,fu(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return ka.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Pu(t).$t({range:r},function(t,e,r){for(var s=mi.fromSegments(t);o&&mi.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=cs(),o=e.path.length+1,s={};if(n.isEqual(Jr.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var u=e.path.toArray(),c=Wa(n);s.range=IDBKeyRange.lowerBound([u,c],!0),s.index=ga.collectionReadTimeIndex}return Pu(t).$t(s,function(t,n,s){if(t.length===o){var a=Qa(r.R,n);e.path.isPrefixOf(a.key.path)?go(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new xu(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Ru(t).get(ma.key).next(function(t){return Gr(!!t),t})},t.prototype.me=function(t,e){return Ru(t).put(ma.key,e)},t.prototype.ye=function(t,e){if(e){var n=Qa(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(Jr.min()))return n}return Pi.newInvalidDocument(t)},t}(),xu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new ku(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(xr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new ss(function(t,e){return Wr(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var u=Ha(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var c=fu(u);r+=c-a,n.push(e.Ie.addEntry(t,o,u))}else if(r-=a,e.trackRemovals){var h=Ha(e.Ie.R,Pi.newNoDocument(o,Jr.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,h))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),ka.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(Cu);function Ru(t){return Ua(t,ma.store)}function Pu(t){return Ua(t,ga.store)}function Lu(t){return t.path.toArray()}var Fu=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Gr(n<r&&n>=0&&r<=11);var o=new Ca("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(la.store)}(t),function(t){t.createObjectStore(fa.store,{keyPath:fa.keyPath}),t.createObjectStore(da.store,{keyPath:da.keyPath,autoIncrement:!0}).createIndex(da.userMutationsIndex,da.userMutationsKeyPath,{unique:!0}),t.createObjectStore(pa.store)}(t),Mu(t),function(t){t.createObjectStore(ga.store)}(t));var s=ka.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(wa.store),t.deleteObjectStore(ba.store),t.deleteObjectStore(Ia.store)}(t),Mu(t)),s=s.next(function(){return function(t){var e=t.store(Ia.store),n=new Ia(0,0,Jr.min().toTimestamp(),0);return e.put(Ia.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(da.store).Nt().next(function(n){t.deleteObjectStore(da.store),t.createObjectStore(da.store,{keyPath:da.keyPath,autoIncrement:!0}).createIndex(da.userMutationsIndex,da.userMutationsKeyPath,{unique:!0});var r=e.store(da.store),i=n.map(function(t){return r.put(t)});return ka.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Ea.store,{keyPath:Ea.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(ma.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(ga.store);e.createIndex(ga.readTimeIndex,ga.readTimeIndexPath,{unique:!1}),e.createIndex(ga.collectionReadTimeIndex,ga.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(_a.store,{keyPath:_a.keyPath})}(t),function(t){t.createObjectStore(Oa.store,{keyPath:Oa.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(ga.store).$t(function(t,n){e+=fu(n)}).next(function(){var n=new ma(e);return t.store(ma.store).put(ma.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(fa.store),r=t.store(da.store);return n.Nt().next(function(n){return ka.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(da.userMutationsIndex,i).next(function(r){return ka.forEach(r,function(r){Gr(r.userId===n.userId);var i=Ja(e.R,r);return lu(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(wa.store),n=t.store(ga.store);return t.store(Ia.store).get(Ia.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new ri(n),s=function(t){return[0,sa(t)]}(o);r.push(e.get(s).next(function(n){return n?ka.resolve():function(n){return e.put(new wa(0,sa(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return ka.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(Ta.store,{keyPath:Ta.keyPath});var n=e.store(Ta.store),r=new su,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:sa(i)})}};return e.store(ga.store).$t({kt:!0},function(t,e){var n=new ri(t);return i(n.popLast())}).next(function(){return e.store(pa.store).$t({kt:!0},function(t,e){var n=ca(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(ba.store);return n.$t(function(t,r){var i=Za(r),o=tu(e.R,i);return n.put(o)})},t}();function Mu(t){t.createObjectStore(wa.store,{keyPath:wa.keyPath}).createIndex(wa.documentTargetsIndex,wa.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(ba.store,{keyPath:ba.keyPath}).createIndex(ba.queryTargetsIndexName,ba.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ia.store)}var Vu="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",qu=function(){function t(e,n,r,i,o,s,a,u,c,h){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=c,this.Ce=h,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Fe=null,this.inForeground=!1,this.ke=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new Lr(Pr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Nu(this,i),this.Le=n+"main",this.R=new za(u),this.Be=new ja(this.Le,11,new Fu(this.R)),this.qe=new bu(this.referenceDelegate,this.R),this.Ut=new au,this.Ue=function(t,e){return new ju(t,e)}(this.R,this.Ut),this.Qe=new nu,this.window&&this.window.localStorage?this.Ke=this.window.localStorage:(this.Ke=null,!1===h&&qr("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Lr(Pr.FAILED_PRECONDITION,Vu);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Rr(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(xr.b)(e,void 0,void 0,function(){return Object(xr.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(xr.b)(e,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(xr.b)(e,void 0,void 0,function(){return Object(xr.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Bu(e).put(new Ea(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Pa(e))return Vr("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Vr("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Uu(t).get(la.key).next(function(t){return ka.resolve(e.tn(t))})},t.prototype.en=function(t){return Bu(t).delete(this.clientId)},t.prototype.nn=function(){return Object(xr.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(xr.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Ua(t,Ea.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return ka.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Ke)for(e=0,n=t;e<n.length;e++)this.Ke.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?ka.resolve(!0):Uu(t).get(la.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new Lr(Pr.FAILED_PRECONDITION,Vu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Bu(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Vr("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(xr.b)(this,void 0,void 0,function(){var t=this;return Object(xr.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[la.store,Ea.store],function(e){var n=new qa(e,Rr.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Bu(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return du.Kt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Vr("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Sa,function(o){return r=new qa(o,i.Ne?i.Ne.next():Rr.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw qr("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new Lr(Pr.FAILED_PRECONDITION,Da);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Uu(t).get(la.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new Lr(Pr.FAILED_PRECONDITION,Vu)})},t.prototype.Ze=function(t){var e=new la(this.clientId,this.allowTabSynchronization,Date.now());return Uu(t).put(la.key,e)},t.yt=function(){return ja.yt()},t.prototype.Xe=function(t){var e=this,n=Uu(t);return n.get(la.key).next(function(t){return e.tn(t)?(Vr("IndexedDbPersistence","Releasing primary lease."),n.delete(la.key)):ka.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(qr("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ke=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.ke),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.ke&&(this.document.removeEventListener("visibilitychange",this.ke),this.ke=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.Fe=function(){e.un(),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.Fe))},t.prototype.hn=function(){this.Fe&&(this.window.removeEventListener("pagehide",this.Fe),this.Fe=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Ke)||void 0===e?void 0:e.getItem(this.on(t)));return Vr("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return qr("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Ke)try{this.Ke.setItem(this.on(this.clientId),String(Date.now()))}catch(t){qr("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Ke)try{this.Ke.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Uu(t){return Ua(t,la.store)}function Bu(t){return Ua(t,Ea.store)}function Ku(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Gu=function(t,e){this.progress=t,this.wn=e},zu=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return mi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):co(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new mi(e)).next(function(t){var e=ls();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=ls();return this.Ut.getCollectionParents(t,i).next(function(s){return ka.forEach(s,function(s){var a=function(t,e){return new no(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var u=a[s],c=u.key,h=r.get(c);null==h&&(h=Pi.newInvalidDocument(c),r=r.insert(c,h)),Uo(u,h,o.localWriteTime),h.isFoundDocument()||(r=r.remove(c))}})}).next(function(){return r.forEach(function(t,n){go(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=ys(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var u=a[s];u instanceof Qo&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(c=c.insert(t,e))}),c})},t}(),Qu=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=ys(),i=ys(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Hu=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(Jr.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(oo(e)||so(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):(Mr()<=E.a.DEBUG&&Vr("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),vo(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new ss(mo(t));return e.forEach(function(e,r){go(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return Mr()<=E.a.DEBUG&&Vr("QueryEngine","Using full collection scan to execute query:",vo(e)),this.Sn.getDocumentsMatchingQuery(t,e,Jr.min())},t}(),Wu=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.Fn=new rs(Wr),this.kn=new ku(function(t){return Mi(t)},Vi),this.$n=Jr.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new zu(this.On,this._n,this.persistence.getIndexManager()),this.Qe=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.Fn)})},t}();function Yu(t,e,n,r){return new Wu(t,e,n,r)}function Xu(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(xr.d)(this,function(s){switch(s.label){case 0:return n=zr(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new zu(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=ys(),a=0,u=o;a<u.length;a++){var c=u[a];n.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++)s=s.add(l[h].key)}for(var f=0,d=e;f<d.length;f++){var p=d[f];r.push(p.batchId);for(var y=0,v=p.mutations;y<v.length;y++)s=s.add(v[y].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function $u(t,e){var n=zr(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=ka.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Gr(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function Ju(t){var e=zr(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function Zu(t,e){var n=zr(t),r=e.snapshotVersion,i=n.Fn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.Fn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var u=e.resumeToken;if(u.approximateByteSize()>0){var c=a.withResumeToken(u,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,c),function(t,e,n){return Gr(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,c,e)&&s.push(n.qe.updateTargetData(t,c))}}});var a=cs();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(tc(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(Jr.min())){var u=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(u)}return ka.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.Fn=i,t})}function tc(t,e,n,r,i){var o=ys();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=cs();return n.forEach(function(n,s){var a=t.get(n),u=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(Jr.min())?(e.removeEntry(n,u),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,u),o=o.insert(n,s)):Vr("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function ec(t,e){var n=zr(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function nc(t,e){var n=zr(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?ka.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Ga(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.Fn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Fn=n.Fn.insert(t.targetId,t),n.kn.set(e,t.targetId)),t})}function rc(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(xr.d)(this,function(a){switch(a.label){case 0:r=zr(t),i=r.Fn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Pa(s=a.sent()))throw s;return Vr("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.Fn=r.Fn.remove(e),r.kn.delete(i.target),[2]}})})}function ic(t,e,n){var r=zr(t),i=Jr.min(),o=ys();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=zr(t),i=r.kn.get(n);return void 0!==i?ka.resolve(r.Fn.get(i)):r.qe.getTargetData(e,n)}(r,t,lo(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:Jr.min(),n?o:ys())}).next(function(t){return{documents:t,Bn:o}})})}function oc(t,e){var n=zr(t),r=zr(n.qe),i=n.Fn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function sc(t){var e=zr(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=zr(t),i=cs(),o=Wa(n),s=Pu(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:ga.readTimeIndex,range:a},function(t,e){var n=Qa(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:Ya(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function ac(t){return Object(xr.b)(this,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){return[2,(e=zr(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Pu(t),n=Jr.min();return e.$t({index:ga.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=Ya(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function uc(t,e,n,r){return Object(xr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c,h,l,f,d;return Object(xr.d)(this,function(p){switch(p.label){case 0:for(i=zr(t),o=ys(),s=cs(),a=ds(),u=0,c=n;u<c.length;u++)l=e.qn((h=c[u]).metadata.name),h.document&&(o=o.add(l)),s=s.insert(l,e.Un(h)),a=a.insert(l,e.Qn(h.metadata.readTime));return f=i.On.newChangeBuffer({trackRemovals:!0}),[4,nc(i,function(t){return lo(io(ri.fromString("__bundle__/docs/"+t)))}(r))];case 1:return d=p.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return tc(t,f,s,Jr.min(),a).next(function(e){return f.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,d.targetId).next(function(){return i.qe.addMatchingKeys(t,o,d.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function cc(t,e,n){return void 0===n&&(n=ys()),Object(xr.b)(this,void 0,void 0,function(){var r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:return[4,nc(t,lo(eu(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=zr(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=xs(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Qe.saveNamedQuery(t,e);var s=r.withResumeToken(ai.EMPTY_BYTE_STRING,o);return i.Fn=i.Fn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Qe.saveNamedQuery(t,e)})})]}})})}var hc=function(){function t(t){this.R=t,this.Kn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return ka.resolve(this.Kn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Kn.set(e.id,{id:(n=e).id,version:n.version,createTime:xs(n.createTime)}),ka.resolve()},t.prototype.getNamedQuery=function(t,e){return ka.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:eu(t.bundledQuery),readTime:xs(t.readTime)}}(e)),ka.resolve()},t}(),lc=function(){function t(){this.Wn=new ss(fc.Gn),this.zn=new ss(fc.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new fc(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new fc(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new mi(new ri([])),r=new fc(n,t),i=new fc(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new mi(new ri([])),n=new fc(e,t),r=new fc(e,t+1),i=ys();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new fc(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),fc=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return mi.comparator(t.key,e.key)||Wr(t.ns,e.ns)},t.Hn=function(t,e){return Wr(t.ns,e.ns)||mi.comparator(t.key,e.key)},t}(),dc=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new ss(fc.Gn)}return t.prototype.checkEmpty=function(t){return ka.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Ba(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var u=a[s];this.rs=this.rs.add(new fc(u.key,i)),this.Ut.addToCollectionParentIndex(t,u.key.path.popLast())}return ka.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ka.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return ka.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ka.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return ka.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new fc(e,0),i=new fc(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),ka.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new ss(Wr);return e.forEach(function(t){var e=new fc(t,0),i=new fc(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),ka.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;mi.isDocumentKey(i)||(i=i.child(""));var o=new fc(new mi(i),0),s=new ss(Wr);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),ka.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Gr(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return ka.forEach(e.mutations,function(i){var o=new fc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new fc(e,0),r=this.rs.firstAfterOrEqual(n);return ka.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return ka.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),pc=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new rs(mi.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ka.resolve(n?n.document.clone():Pi.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=cs();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Pi.newInvalidDocument(t))}),ka.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=cs(),i=new mi(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,u=a.document,c=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;c.compareTo(n)<=0||go(e,u)&&(r=r.insert(u.key,u.clone()))}return ka.resolve(r)},t.prototype.fs=function(t,e){return ka.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new yc(this)},t.prototype.getSize=function(t){return ka.resolve(this.size)},t}(),yc=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(xr.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),ka.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(Cu),vc=function(){function t(t){this.persistence=t,this.ds=new ku(function(t){return Mi(t)},Vi),this.lastRemoteSnapshotVersion=Jr.min(),this.highestTargetId=0,this.ws=0,this._s=new lc,this.targetCount=0,this.ys=mu.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),ka.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ka.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ka.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),ka.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),ka.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new mu(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,ka.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),ka.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,ka.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),ka.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return ka.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return ka.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),ka.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),ka.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),ka.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return ka.resolve(n)},t.prototype.containsKey=function(t,e){return ka.resolve(this._s.containsKey(e))},t}(),gc=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Rr(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new vc(this),this.Ut=new ou,this.Ue=function(t,e){return new pc(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new za(e),this.Qe=new hc(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new dc(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Qe},t.prototype.runTransaction=function(t,e,n){var r=this;Vr("MemoryPersistence","Starting transaction:",t);var i=new mc(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return ka.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),mc=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(xr.c)(e,t),e}(Na),bc=function(){function t(t){this.persistence=t,this.As=new lc,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Kr()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),ka.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),ka.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),ka.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ka.forEach(this.vs,function(r){var i=mi.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return ka.or([function(){return ka.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),wc=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Ic(t,e){return"firestore_clients_"+t+"_"+e}function Tc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Ec(t,e){return"firestore_targets_"+t+"_"+e}wc.UNAUTHENTICATED=new wc(null),wc.GOOGLE_CREDENTIALS=new wc("google-credentials-uid"),wc.FIRST_PARTY=new wc("first-party-uid");var _c=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new Lr(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(qr("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Oc=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new Lr(i.error.code,i.error.message)),o?new t(e,i.state,r):(qr("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Sc=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=gs(),s=0;i&&s<r.activeTargetIds.length;++s)i=gi(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(qr("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Dc=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(qr("SharedClientState","Failed to parse online state: "+e),null)},t}(),Nc=function(){function t(){this.activeTargetIds=gs()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Ac=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.Fs.bind(this),this.ks=new rs(Wr),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Ic(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.ks=this.ks.insert(this.Ns,new Nc),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Qs=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(xr.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,u,c,h=this;return Object(xr.d)(this,function(l){switch(l.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=l.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Ic(this.persistenceKey,r)))&&(o=Sc.Vs(r,i))&&(this.ks=this.ks.insert(o.clientId,o));for(this.Ks(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),u=0,c=this.$s;u<c.length;u++)this.Fs(c[u]);return this.$s=[],this.window.addEventListener("pagehide",function(){return h.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.ks)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.ks.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Ec(this.persistenceKey,t));if(n){var r=Oc.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Ks(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Ks()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Ec(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Vr("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Vr("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Vr("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.Fs=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Vr("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void qr("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(xr.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(xr.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Rr.o;if(null!=t)try{var n=JSON.parse(t);Gr("number"==typeof n),e=n}catch(t){qr("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Rr.o&&this.sequenceNumberHandler(s);else if(n.key===this.Qs)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.ks.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Ks=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new _c(this.currentUser,t,e,n),i=Tc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=Tc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Ec(this.persistenceKey,t),i=new Oc(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Qs,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Sc.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return _c.Vs(new wc(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Oc.Vs(r,e)},t.prototype.js=function(t){return Dc.Vs(t)},t.prototype.ii=function(t){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Vr("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.ks.insert(t,e):this.ks.remove(t),i=this.Gs(this.ks),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.ks=r})},t.prototype.Ws=function(t){this.ks.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=gs();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),kc=function(){function t(){this.li=new Nc,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Nc,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),Cc=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),jc=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Vr("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Vr("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),xc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Rc=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Pc=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(xr.c)(e,t),e.prototype.ki=function(t,e,n,r){return new Promise(function(i,o){var s=new jr;s.listenOnce(Nr.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Dr.NO_ERROR:var e=s.getResponseJson();Vr("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Dr.TIMEOUT:Vr("Connection",'RPC "'+t+'" timed out'),o(new Lr(Pr.DEADLINE_EXCEEDED,"Request time out"));break;case Dr.HTTP_ERROR:var n=s.getStatus();if(Vr("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Pr).indexOf(e)>=0?e:Pr.UNKNOWN}(r.status);o(new Lr(a,r.message))}else o(new Lr(Pr.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new Lr(Pr.UNAVAILABLE,"Connection failed."));break;default:Kr()}}finally{Vr("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new vr,i=me(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new kr({})),this.Fi(o.initMessageHeaders,e),Object(T.w)()||Object(T.z)()||Object(T.t)()||Object(T.v)()||Object(T.A)()||Object(T.s)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Vr("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),u=!1,c=!1,h=new Rc({Ei:function(t){c?Vr("Connection","Not sending because WebChannel is closed:",t):(u||(Vr("Connection","Opening WebChannel transport."),a.open(),u=!0),Vr("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),l=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return l(a,Cr.EventType.OPEN,function(){c||Vr("Connection","WebChannel transport opened.")}),l(a,Cr.EventType.CLOSE,function(){c||(c=!0,Vr("Connection","WebChannel transport closed"),h.Vi())}),l(a,Cr.EventType.ERROR,function(t){c||(c=!0,Ur("Connection","WebChannel transport errored:",t),h.Vi(new Lr(Pr.UNAVAILABLE,"The operation could not be completed")))}),l(a,Cr.EventType.MESSAGE,function(t){var e;if(!c){var n=t.data[0];Gr(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Vr("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=Xo[t];if(void 0!==e)return ns(e)}(i),s=r.message;void 0===o&&(o=Pr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),c=!0,h.Vi(new Lr(o,s)),a.close()}else Vr("Connection","WebChannel received:",n),h.Si(n)}}),l(i,Ar.STAT_EVENT,function(t){10===t.stat?Vr("Connection","Detected buffering proxy"):11===t.stat&&Vr("Connection","Detected no buffering proxy")}),setTimeout(function(){h.Pi()},0),h},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Vr("RestConnection","Sending: ",i,n);var o={};return this.Fi(o,r),this.ki(t,i,o,n).then(function(t){return Vr("RestConnection","Received: ",t),t},function(e){throw Ur("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.Fi=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.6.7",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+xc[t]},t}());function Lc(){return"undefined"!=typeof window?window:null}function Fc(){return"undefined"!=typeof document?document:null}function Mc(t){return new As(t,!0)}var Vc=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Qi=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Ki=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Qi),i=Math.max(0,n-r);i>0&&Vr("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Qi=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),qc=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new Vc(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Pr.RESOURCE_EXHAUSTED?(qr(e.toString()),qr("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Ki()):e&&e.code===Pr.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new Lr(Pr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(xr.b)(t,void 0,void 0,function(){return Object(xr.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Vr("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Vr("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Uc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(xr.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Kr()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Gr(void 0===e||"string"==typeof e),ai.fromBase64String(e||"")):(Gr(void 0===e||e instanceof Uint8Array),ai.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Pr.UNKNOWN:ns(t.code);return new Lr(e,t.message||"")}(a);n=new Ts(r,i,o,s||null)}else if("documentChange"in e){i=Fs(t,(r=e.documentChange).document.name),o=xs(r.document.updateTime);var a=new xi({mapValue:{fields:r.document.fields}}),u=(s=Pi.newFoundDocument(i,o,a),r.targetIds||[]);n=new ws(u,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=Fs(t,(r=e.documentDelete).document),o=r.readTime?xs(r.readTime):Jr.min(),a=Pi.newNoDocument(i,o),n=new ws([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=Fs(t,(r=e.documentRemove).document),n=new ws([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Kr();var c=e.filter;i=new ts(r=c.count||0),n=new Is(o=c.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return Jr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?Jr.min():e.readTime?xs(e.readTime):Jr.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=qs(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=qi(r)?{documents:Qs(t,r)}:{query:Hs(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=Cs(t,e.resumeToken):e.snapshotVersion.compareTo(Jr.min())>0&&(n.readTime=ks(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Kr()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=qs(this.R),e.removeTarget=t,this.cr(e)},e}(qc),Bc=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(xr.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Gr(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Gr(void 0!==e),t.map(function(t){return function(t,e){var n=xs(t.updateTime?t.updateTime:e);return n.isEqual(Jr.min())&&(n=xs(e)),new Lo(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=xs(t.commitTime);return this.listener.Tr(n,e)}return Gr(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=qs(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Gs(e.R,t)})};this.cr(n)},e}(qc),Kc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(xr.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new Lr(Pr.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Pr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Lr(Pr.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Pr.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new Lr(Pr.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Gc=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.Fr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.Fr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(qr(e),this.Vr=!1):Vr("OnlineStateTracker",e)},t.prototype.Fr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),zc=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.kr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(xr.b)(o,void 0,void 0,function(){return Object(xr.d)(this,function(t){switch(t.label){case 0:return th(this)?(Vr("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(xr.b)(this,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return(e=zr(t)).Or.add(4),[4,Hc(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Qc(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Gc(n,r)};function Qc(t){return Object(xr.b)(this,void 0,void 0,function(){var e,n;return Object(xr.d)(this,function(r){switch(r.label){case 0:if(!th(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Hc(t){return Object(xr.b)(this,void 0,void 0,function(){var e,n;return Object(xr.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Wc(t,e){var n=zr(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),Zc(n)?Jc(n):yh(n).er()&&Xc(n,e))}function Yc(t,e){var n=zr(t),r=yh(n);n.$r.delete(e),r.er()&&$c(n,e),0===n.$r.size&&(r.er()?r.ir():th(n)&&n.Br.set("Unknown"))}function Xc(t,e){t.qr.U(e.targetId),yh(t).mr(e)}function $c(t,e){t.qr.U(e),yh(t).yr(e)}function Jc(t){t.qr=new _s({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),yh(t).start(),t.Br.Sr()}function Zc(t){return th(t)&&!yh(t).tr()&&t.$r.size>0}function th(t){return 0===zr(t).Or.size}function eh(t){t.qr=void 0}function nh(t){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(e){return t.$r.forEach(function(e,n){Xc(t,e)}),[2]})})}function rh(t,e){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(n){return eh(t),Zc(t)?(t.Br.Nr(e),Jc(t)):t.Br.set("Unknown"),[2]})})}function ih(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i,o;return Object(xr.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof Ts&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(xr.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Vr("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,oh(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof ws?t.qr.X(e):e instanceof Is?t.qr.rt(e):t.qr.et(e),n.isEqual(Jr.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,Ju(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(ai.EMPTY_BYTE_STRING,n.snapshotVersion)),$c(t,e);var r=new Ga(n.target,e,1,n.sequenceNumber);Xc(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Vr("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,oh(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function oh(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r=this;return Object(xr.d)(this,function(i){switch(i.label){case 0:if(!Pa(e))throw e;return t.Or.add(1),[4,Hc(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return Ju(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(xr.b)(r,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return Vr("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Qc(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function sh(t,e){return e().catch(function(n){return oh(t,n,e)})}function ah(t){return Object(xr.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(xr.d)(this,function(s){switch(s.label){case 0:e=zr(t),n=vh(e),r=e.kr.length>0?e.kr[e.kr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return th(t)&&t.kr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,ec(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.kr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.kr.push(e);var n=vh(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,oh(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return uh(e)&&ch(e),[2]}})})}function uh(t){return th(t)&&!vh(t).tr()&&t.kr.length>0}function ch(t){vh(t).start()}function hh(t){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(e){return vh(t).Ar(),[2]})})}function lh(t){return Object(xr.b)(this,void 0,void 0,function(){var e,n,r;return Object(xr.d)(this,function(i){for(e=vh(t),n=0,r=t.kr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function fh(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:return r=t.kr.shift(),i=Ka.from(r,e,n),[4,sh(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,ah(t)];case 2:return o.sent(),[2]}})})}function dh(t,e){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(n){switch(n.label){case 0:return e&&vh(t).pr?[4,function(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r;return Object(xr.d)(this,function(i){switch(i.label){case 0:return es(r=e.code)&&r!==Pr.ABORTED?(n=t.kr.shift(),vh(t).sr(),[4,sh(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,ah(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return uh(t)&&ch(t),[2]}})})}function ph(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n;return Object(xr.d)(this,function(r){switch(r.label){case 0:return n=zr(t),e?(n.Or.delete(2),[4,Qc(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Hc(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function yh(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=zr(t);return r.br(),new Uc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:nh.bind(null,t),Ri:rh.bind(null,t),_r:ih.bind(null,t)}),t.Mr.push(function(n){return Object(xr.b)(e,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),Zc(t)?Jc(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),eh(t),e.label=3;case 3:return[2]}})})})),t.Ur}function vh(t){var e=this;return t.Qr||(t.Qr=function(t,e,n){var r=zr(t);return r.br(),new Bc(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:hh.bind(null,t),Ri:dh.bind(null,t),Ir:lh.bind(null,t),Tr:fh.bind(null,t)}),t.Mr.push(function(n){return Object(xr.b)(e,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return n?(t.Qr.sr(),[4,ah(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Qr.stop()];case 3:e.sent(),t.kr.length>0&&(Vr("RemoteStore","Stopping write stream with "+t.kr.length+" pending writes"),t.kr=[]),e.label=4;case 4:return[2]}})})})),t.Qr}var gh=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Aa,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Lr(Pr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function mh(t,e){if(qr("AsyncQueue",e+": "+t),Pa(t))return new Lr(Pr.UNAVAILABLE,e+": "+t);throw t}var bh=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||mi.comparator(e.key,n.key)}:function(t,e){return mi.comparator(t.key,e.key)},this.keyedMap=ls(),this.sortedSet=new rs(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),wh=function(){function t(){this.Kr=new rs(mi.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Kr.get(e);n?0!==t.type&&3===n.type?this.Kr=this.Kr.insert(e,t):3===t.type&&1!==n.type?this.Kr=this.Kr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Kr=this.Kr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Kr=this.Kr.remove(e):1===t.type&&2===n.type?this.Kr=this.Kr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Kr=this.Kr.insert(e,{type:2,doc:t.doc}):Kr():this.Kr=this.Kr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Kr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Ih=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,bh.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&po(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Th=function(){this.Wr=void 0,this.listeners=[]},Eh=function(){this.queries=new ku(function(t){return yo(t)},po),this.onlineState="Unknown",this.Gr=new Set};function _h(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(xr.d)(this,function(c){switch(c.label){case 0:if(n=zr(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Th),!i)return[3,4];c.label=1;case 1:return c.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=c.sent(),[3,4];case 3:return a=c.sent(),u=mh(a,"Initialization of query '"+vo(e.query)+"' failed"),[2,void e.onError(u)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Nh(n),[2]}})})}function Oh(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(xr.d)(this,function(a){return n=zr(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Sh(t,e){for(var n=zr(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var u=0,c=a.listeners;u<c.length;u++)c[u].Hr(s)&&(r=!0);a.Wr=s}}r&&Nh(n)}function Dh(t,e,n){var r=zr(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Nh(t){t.Gr.forEach(function(t){t.next()})}var Ah=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new Ih(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=Ih.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),kh=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),Ch=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return Fs(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Ks(this.R,t.document,!1):Pi.newNoDocument(this.qn(t.metadata.name),this.Qn(t.metadata.readTime))},t.prototype.Qn=function(t){return xs(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new Ch(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,u=o.metadata.queries;a<u.length;a++){var c=u[a],h=(e.get(c)||ys()).add(s);e.set(c,h)}}return e},t.prototype.complete=function(){return Object(xr.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:return[4,uc(this.localStore,new Ch(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,cc(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Gu(Object.assign({},this.progress),t))]}})})}}();var jh=function(t){this.key=t},xh=function(t){this.key=t},Rh=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=ys(),this.mutatedKeys=ys(),this.lo=mo(t),this.fo=new bh(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new wh,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,u=oo(this.query)&&i.size===this.query.limit?i.last():null,c=so(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var h=i.get(t),l=go(n.query,e)?e:null,f=!!h&&n.mutatedKeys.has(h.key),d=!!l&&(l.hasLocalMutations||n.mutatedKeys.has(l.key)&&l.hasCommittedMutations),p=!1;h&&l?h.data.isEqual(l.data)?f!==d&&(r.track({type:3,doc:l}),p=!0):n.yo(h,l)||(r.track({type:2,doc:l}),p=!0,(u&&n.lo(l,u)>0||c&&n.lo(l,c)<0)&&(a=!0)):!h&&l?(r.track({type:0,doc:l}),p=!0):h&&!l&&(r.track({type:1,doc:h}),p=!0,(u||c)&&(a=!0)),p&&(l?(s=s.add(l),o=d?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),oo(this.query)||so(this.query))for(;s.size>this.query.limit;){var h=oo(this.query)?s.last():s.first();s=s.delete(h.key),o=o.delete(h.key),r.track({type:1,doc:h})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Kr()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,u=a!==this.ao;return this.ao=a,0!==o.length||u?{snapshot:new Ih(this.query,t.fo,i,o,t.mutatedKeys,0===a,u,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new wh,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=ys(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new xh(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new jh(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=ys();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return Ih.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Ph=function(t,e,n){this.query=t,this.targetId=e,this.view=n},Lh=function(t){this.key=t,this.bo=!1},Fh=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new ku(function(t){return yo(t)},po),this.Vo=new Map,this.So=new Set,this.Do=new rs(mi.comparator),this.Co=new Map,this.No=new lc,this.xo={},this.Fo=new Map,this.ko=mu.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function Mh(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(xr.d)(this,function(a){switch(a.label){case 0:return n=dl(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,nc(n.localStore,lo(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Vh(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&Wc(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Vh(t,e,n,r){return Object(xr.b)(this,void 0,void 0,function(){var i,o,s,a,u,c;return Object(xr.d)(this,function(h){switch(h.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(xr.b)(this,void 0,void 0,function(){var i,o,s;return Object(xr.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,ic(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(Jh(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,ic(t.localStore,e,!0)];case 1:return i=h.sent(),o=new Rh(e,i.Bn),s=o._o(i.documents),a=bs.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),u=o.applyChanges(s,t.isPrimaryClient,a),Jh(t,n,u.To),c=new Ph(e,n,o),[2,(t.Po.set(e,c),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),u.snapshot)]}})})}function qh(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:return n=zr(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!po(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,rc(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),Yc(n.remoteStore,r.targetId),Xh(n,r.targetId)}).catch(Eu)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return Xh(n,r.targetId),[4,rc(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Uh(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(xr.d)(this,function(a){switch(a.label){case 0:r=pl(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=zr(t),i=$r.now(),o=e.reduce(function(t,e){return t.add(e.key)},ys());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,u=e;a<u.length;a++){var c=u[a],h=Bo(c,n.get(c.key));null!=h&&s.push(new Qo(c.key,h,Ri(h.value.mapValue),Fo.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new rs(Wr)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,el(r,i.changes)];case 3:return a.sent(),[4,ah(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=mh(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Bh(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r;return Object(xr.d)(this,function(i){switch(i.label){case 0:n=zr(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,Zu(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Gr(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Gr(r.bo):t.removedDocuments.size>0&&(Gr(r.bo),r.bo=!1))}),[4,el(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Eu(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Kh(t,e,n){var r=zr(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=zr(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Nh(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Gh(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u;return Object(xr.d)(this,function(c){switch(c.label){case 0:return(r=zr(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new rs(mi.comparator)).insert(o,Pi.newNoDocument(o,Jr.min())),a=ys().add(o),u=new ms(Jr.min(),new Map,new ss(Wr),s,a),[4,Bh(r,u)]):[3,2];case 1:return c.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),tl(r),[3,4];case 2:return[4,rc(r.localStore,e,!1).then(function(){return Xh(r,e,n)}).catch(Eu)];case 3:c.sent(),c.label=4;case 4:return[2]}})})}function zh(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:n=zr(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,$u(n.localStore,e)];case 2:return i=o.sent(),Yh(n,r,null),Wh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,el(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Eu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Qh(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:r=zr(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=zr(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Gr(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),Yh(r,e,n),Wh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,el(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Eu(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Hh(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(xr.d)(this,function(a){switch(a.label){case 0:th((n=zr(t)).remoteStore)||Vr("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=zr(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.Fo.get(r)||[]).push(e),n.Fo.set(r,i),[3,4]);case 3:return o=a.sent(),s=mh(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function Wh(t,e){(t.Fo.get(e)||[]).forEach(function(t){t.resolve()}),t.Fo.delete(e)}function Yh(t,e,n){var r=zr(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function Xh(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||$h(t,e)})}function $h(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(Yc(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),tl(t))}function Jh(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof jh?(t.No.addReference(o.key,e),Zh(t,o)):o instanceof xh?(Vr("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||$h(t,o.key)):Kr()}}function Zh(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Vr("SyncEngine","New document in limbo: "+n),t.So.add(r),tl(t))}function tl(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new mi(ri.fromString(e)),r=t.ko.next();t.Co.set(r,new Lh(n)),t.Do=t.Do.insert(n,r),Wc(t.remoteStore,new Ga(lo(io(n.path)),r,2,Rr.o))}}function el(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(xr.d)(this,function(a){switch(a.label){case 0:return r=zr(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Qu.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c;return Object(xr.d)(this,function(h){switch(h.label){case 0:n=zr(t),h.label=1;case 1:return h.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return ka.forEach(e,function(e){return ka.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return ka.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return h.sent(),[3,4];case 3:if(!Pa(r=h.sent()))throw r;return Vr("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(u=n.Fn.get(a),c=u.withLastLimboFreeSnapshotVersion(u.snapshotVersion),n.Fn=n.Fn.insert(a,c));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function nl(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r;return Object(xr.d)(this,function(i){switch(i.label){case 0:return(n=zr(t)).currentUser.isEqual(e)?[3,3]:(Vr("SyncEngine","User change. New user:",e.toKey()),[4,Xu(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.Fo.forEach(function(t){t.forEach(function(t){t.reject(new Lr(Pr.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Fo.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,el(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function rl(t,e){var n=zr(t),r=n.Co.get(e);if(r&&r.bo)return ys().add(r.key);var i=ys(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var u=n.Po.get(a[s]);i=i.unionWith(u.view.wo)}return i}function il(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:return[4,ic((n=zr(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&Jh(n,e.targetId,i.To),i)]}})})}function ol(t){return Object(xr.b)(this,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){return[2,sc((e=zr(t)).localStore).then(function(t){return el(e,t)})]})})}function sl(t,e,n,r){return Object(xr.b)(this,void 0,void 0,function(){var i,o;return Object(xr.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=zr(t),r=zr(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):ka.resolve(null)})})}((i=zr(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,ah(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(Yh(i,e,r||null),Wh(i,e),function(t,e){zr(zr(t)._n).Gt(e)}(i.localStore,e)):Kr(),s.label=4;case 4:return[4,el(i,o)];case 5:return s.sent(),[3,7];case 6:Vr("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function al(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u;return Object(xr.d)(this,function(c){switch(c.label){case 0:return dl(n=zr(t)),pl(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,ul(n,r.toArray())]);case 1:return i=c.sent(),n.$o=!0,[4,ph(n.remoteStore,!0)];case 2:for(c.sent(),o=0,s=i;o<s.length;o++)Wc(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],u=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):u=u.then(function(){return Xh(n,e),rc(n.localStore,e,!0)}),Yc(n.remoteStore,e)}),[4,u]);case 4:return c.sent(),[4,ul(n,a)];case 5:return c.sent(),function(t){var e=zr(t);e.Co.forEach(function(t,n){Yc(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new rs(mi.comparator)}(n),n.$o=!1,[4,ph(n.remoteStore,!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})}function ul(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,u,c,h,l,f,d,p;return Object(xr.d)(this,function(y){switch(y.label){case 0:n=zr(t),r=[],i=[],o=0,s=e,y.label=1;case 1:return o<s.length?(u=void 0,(c=n.Vo.get(a=s[o]))&&0!==c.length?[4,nc(n.localStore,lo(c[0]))]:[3,7]):[3,13];case 2:u=y.sent(),h=0,l=c,y.label=3;case 3:return h<l.length?(f=n.Po.get(l[h]),[4,il(n,f)]):[3,6];case 4:(d=y.sent()).snapshot&&i.push(d.snapshot),y.label=5;case 5:return h++,[3,3];case 6:return[3,11];case 7:return[4,oc(n.localStore,a)];case 8:return p=y.sent(),[4,nc(n.localStore,p)];case 9:return u=y.sent(),[4,Vh(n,cl(p),a,!1)];case 10:y.sent(),y.label=11;case 11:r.push(u),y.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function cl(t){return ro(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function hl(t){var e=zr(t);return zr(zr(e.localStore).persistence).fn()}function ll(t,e,n,r){return Object(xr.b)(this,void 0,void 0,function(){var i,o,s;return Object(xr.d)(this,function(a){switch(a.label){case 0:return(i=zr(t)).$o?(Vr("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,sc(i.localStore)];case 3:return o=a.sent(),s=ms.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,el(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,rc(i.localStore,e,!0)];case 6:return a.sent(),Xh(i,e,r),[3,8];case 7:Kr(),a.label=8;case 8:return[2]}})})}function fl(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i,o,s,a,u,c,h,l;return Object(xr.d)(this,function(f){switch(f.label){case 0:if(!(r=dl(t)).$o)return[3,10];i=0,o=e,f.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Vr("SyncEngine","Adding an already active target "+s),[3,5]):[4,oc(r.localStore,s)]:[3,6];case 2:return a=f.sent(),[4,nc(r.localStore,a)];case 3:return u=f.sent(),[4,Vh(r,cl(a),u.targetId,!1)];case 4:f.sent(),Wc(r.remoteStore,u),f.label=5;case 5:return i++,[3,1];case 6:c=function(t){return Object(xr.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,rc(r.localStore,t,!1).then(function(){Yc(r.remoteStore,t),Xh(r,t)}).catch(Eu)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},h=0,l=n,f.label=7;case 7:return h<l.length?[5,c(l[h])]:[3,10];case 8:f.sent(),f.label=9;case 9:return h++,[3,7];case 10:return[2]}})})}function dl(t){var e=zr(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Bh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=rl.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Gh.bind(null,e),e.vo._r=Sh.bind(null,e.eventManager),e.vo.Mo=Dh.bind(null,e.eventManager),e}function pl(t){var e=zr(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=zh.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Qh.bind(null,e),e}var yl=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return this.R=Mc(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Qo(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Qo=function(t){return Yu(this.persistence,new Hu,t.initialUser,this.R)},t.prototype.qo=function(t){return new gc(bc.bs,this.R)},t.prototype.Bo=function(t){return new kc},t.prototype.terminate=function(){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),vl=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Ko=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(xr.c)(e,t),e.prototype.initialize=function(e){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(n){switch(n.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return n.sent(),[4,ac(this.localStore)];case 2:return n.sent(),[4,this.Ko.initialize(this,e)];case 3:return n.sent(),[4,pl(this.Ko.syncEngine)];case 4:return n.sent(),[4,ah(this.Ko.remoteStore)];case 5:return n.sent(),[2]}})})},e.prototype.Qo=function(t){return Yu(this.persistence,new Hu,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Su(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Ku(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?hu.withCacheSize(this.cacheSizeBytes):hu.DEFAULT;return new qu(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Lc(),Fc(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new kc},e}(yl),gl=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Ko=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(xr.c)(e,t),e.prototype.initialize=function(e){return Object(xr.b)(this,void 0,void 0,function(){var n,r=this;return Object(xr.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Ko.syncEngine,this.sharedClientState instanceof Ac?(this.sharedClientState.syncEngine={ui:sl.bind(null,n),ai:ll.bind(null,n),hi:fl.bind(null,n),fn:hl.bind(null,n),ci:ol.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(xr.b)(r,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return[4,al(this.Ko.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Lc();if(!Ac.yt(e))throw new Lr(Pr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Ku(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Ac(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(vl),ml=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n=this;return Object(xr.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Kh(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=nl.bind(null,this.syncEngine),[4,ph(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Eh},t.prototype.createDatastore=function(t){var e=Mc(t.databaseInfo.databaseId),n=new Pc(t.databaseInfo);return function(t,e,n){return new Kc(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Kh(s.syncEngine,t,0)},o=jc.yt()?new jc:new Cc,new zc(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Fh(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(xr.b)(this,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return e=zr(t),Vr("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Hc(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),bl=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),wl=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Aa,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(xr.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(xr.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new kh(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(xr.b)(this,void 0,void 0,function(){var t,e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(xr.b)(this,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(xr.b)(this,void 0,void 0,function(){var t,e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(xr.b)(this,void 0,void 0,function(){var e,n=this;return Object(xr.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Lr(Pr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(xr.d)(this,function(u){switch(u.label){case 0:return n=zr(t),r=qs(n.R)+"/documents",i={documents:e.map(function(t){return Ls(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=u.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Gr(!!e.found);var n=Fs(t,e.found.name),r=xs(e.found.updateTime),i=new xi({mapValue:{fields:e.found.fields}});return Pi.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Gr(!!e.missing),Gr(!!e.readTime);var n=Fs(t,e.missing),r=xs(e.readTime);return Pi.newNoDocument(n,r)}(t,e):Kr()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Gr(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new Jo(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(xr.b)(this,void 0,void 0,function(){var t,e=this;return Object(xr.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=mi.fromPath(n);e.mutations.push(new Zo(r,e.precondition(r)))}),[4,function(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:return n=zr(t),r=qs(n.R)+"/documents",i={writes:e.map(function(t){return Gs(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Kr();e=Jr.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new Lr(Pr.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?Fo.updateTime(e):Fo.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(Jr.min()))throw new Lr(Pr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Fo.updateTime(e)}return Fo.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),Il=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new Vc(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(xr.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(xr.d)(this,function(r){return t=new wl(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!yi(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!es(e)}return!1},t}(),Tl=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=wc.UNAUTHENTICATED,this.clientId=Hr.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(xr.b)(r,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return Vr("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Lr(Pr.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Aa;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(xr.b)(t,void 0,void 0,function(){var t,n;return Object(xr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=mh(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function El(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(xr.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Vr("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(xr.b)(i,void 0,void 0,function(){return Object(xr.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,Xu(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function _l(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r;return Object(xr.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Ol(t)];case 1:return n=i.sent(),Vr("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(xr.b)(this,void 0,void 0,function(){var n,r;return Object(xr.d)(this,function(i){switch(i.label){case 0:return(n=zr(t)).asyncQueue.verifyOperationInProgress(),Vr("RemoteStore","RemoteStore received new credentials"),r=th(n),n.Or.add(3),[4,Hc(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Qc(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Ol(t){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Vr("FirestoreClient","Using default OfflineComponentProvider"),[4,El(t,new yl)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Sl(t){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Vr("FirestoreClient","Using default OnlineComponentProvider"),[4,_l(t,new ml)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Dl(t){return Ol(t).then(function(t){return t.persistence})}function Nl(t){return Ol(t).then(function(t){return t.localStore})}function Al(t){return Sl(t).then(function(t){return t.remoteStore})}function kl(t){return Sl(t).then(function(t){return t.syncEngine})}function Cl(t){return Object(xr.b)(this,void 0,void 0,function(){var e,n;return Object(xr.d)(this,function(r){switch(r.label){case 0:return[4,Sl(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=Mh.bind(null,e.syncEngine),n.onUnlisten=qh.bind(null,e.syncEngine),n)]}})})}function jl(t,e,n){var r=this;void 0===n&&(n={});var i=new Aa;return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(r,void 0,void 0,function(){var r;return Object(xr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new bl({next:function(o){e.enqueueAndForget(function(){return Oh(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new Lr(Pr.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new Lr(Pr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Ah(io(n.path),o,{includeMetadataChanges:!0,so:!0});return _h(t,s)},[4,Cl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function xl(t,e,n){var r=this;void 0===n&&(n={});var i=new Aa;return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(r,void 0,void 0,function(){var r;return Object(xr.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new bl({next:function(n){e.enqueueAndForget(function(){return Oh(t,s)}),n.fromCache&&"server"===r.source?i.reject(new Lr(Pr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Ah(n,o,{includeMetadataChanges:!0,so:!0});return _h(t,s)},[4,Cl(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Rl=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Pl=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),Ll=new Map,Fl=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},Ml=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(wc.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Vl=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),ql=function(){function t(t){var e=this;this.currentUser=wc.UNAUTHENTICATED,this.oc=new Aa,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Vr("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Vr("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Vr("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Gr("string"==typeof n.accessToken),new Fl(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(xr.b)(n,void 0,void 0,function(){return Object(xr.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Gr(null===t||"string"==typeof t),new wc(t)},t}(),Ul=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=wc.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Bl=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Ul(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(wc.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Kl(t,e,n){if(!n)throw new Lr(Pr.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Gl(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function zl(t,e,n,r){if(!0===e&&!0===r)throw new Lr(Pr.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Ql(t){if(!mi.isDocumentKey(t))throw new Lr(Pr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function Hl(t){if(mi.isDocumentKey(t))throw new Lr(Pr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function Wl(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Kr()}function Yl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Lr(Pr.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Wl(t);throw new Lr(Pr.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function Xl(t,e){if(e<=0)throw new Lr(Pr.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var $l=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new Lr(Pr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Lr(Pr.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,zl("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),Jl=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new $l({}),this._settingsFrozen=!1,t instanceof Pl?(this._databaseId=t,this._credentials=new Ml):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Lr(Pr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Pl(t.options.projectId)}(t),this._credentials=new ql(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new Lr(Pr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new Lr(Pr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new $l(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new Ml;switch(t.type){case"gapi":var e=t.client;return Gr(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Bl(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new Lr(Pr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=Ll.get(this))&&(Vr("ComponentProvider","Removing Datastore"),Ll.delete(this),t.terminate()),Promise.resolve();var t},t}(),Zl=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new ef(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),tf=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),ef=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,io(r))||this)._path=r,i.type="collection",i}return Object(xr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new Zl(this.firestore,null,new mi(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(tf);function nf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(T.o)(t),Kl("collection","path",e),t instanceof Jl)return Hl(n=ri.fromString.apply(ri,Object(xr.f)([e],r))),new ef(t,null,n);if(!(t instanceof Zl||t instanceof ef))throw new Lr(Pr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Hl(n=ri.fromString.apply(ri,Object(xr.f)([t.path],r)).child(ri.fromString(e))),new ef(t.firestore,null,n)}function rf(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(T.o)(t),1===arguments.length&&(e=Hr.u()),Kl("doc","path",e),t instanceof Jl)return Ql(n=ri.fromString.apply(ri,Object(xr.f)([e],r))),new Zl(t,null,new mi(n));if(!(t instanceof Zl||t instanceof ef))throw new Lr(Pr.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Ql(n=t._path.child(ri.fromString.apply(ri,Object(xr.f)([e],r)))),new Zl(t.firestore,t instanceof ef?t.converter:null,new mi(n))}function of(t,e){return t=Object(T.o)(t),e=Object(T.o)(e),(t instanceof Zl||t instanceof ef)&&(e instanceof Zl||e instanceof ef)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function sf(t,e){return t=Object(T.o)(t),e=Object(T.o)(e),t instanceof tf&&e instanceof tf&&t.firestore===e.firestore&&po(t._query,e._query)&&t.converter===e.converter}var af=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=[],this.Zi=new Vc(this,"async_queue_retry"),this.Tc=function(){var e=Fc();e&&Vr("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=Fc();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Tc)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ic(),this.Ac(t)},t.prototype.enterRestrictedMode=function(){if(!this._c){this._c=!0;var t=Fc();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Tc)}},t.prototype.enqueue=function(t){return this.Ic(),this._c?new Promise(function(t){}):this.Ac(t)},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.Rc()})},t.prototype.Rc=function(){return Object(xr.b)(this,void 0,void 0,function(){var t,e=this;return Object(xr.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Pa(t=n.sent()))throw t;return Vr("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.Rc()}),n.label=5;case 5:return[2]}})})},t.prototype.Ac=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,qr("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ic(),this.Ec.indexOf(t)>-1&&(e=0);var i=gh.createAndSchedule(this,t,e,n,function(t){return r.bc(t)});return this.mc.push(i),i},t.prototype.Ic=function(){this.yc&&Kr()},t.prototype.verifyOperationInProgress=function(){},t.prototype.vc=function(){return Object(xr.b)(this,void 0,void 0,function(){var t;return Object(xr.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Pc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Vc=function(t){var e=this;return this.vc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.vc()})},t.prototype.Sc=function(t){this.Ec.push(t)},t.prototype.bc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function uf(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Aa,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var cf=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new af,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(xr.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||lf(this),this._firestoreClient.terminate()},e}(Jl);function hf(t){return t._firestoreClient||lf(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function lf(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Rl(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Tl(t._credentials,t._queue,r)}function ff(t,e,n){var r=this,i=new Aa;return t.asyncQueue.enqueue(function(){return Object(xr.b)(r,void 0,void 0,function(){var r;return Object(xr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,El(t,n)];case 1:return o.sent(),[4,_l(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Pr.FAILED_PRECONDITION||t.code===Pr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function df(t){if(t._initialized||t._terminated)throw new Lr(Pr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var pf=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new oi(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),yf=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(ai.fromBase64String(e))}catch(e){throw new Lr(Pr.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(ai.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),vf=function(t){this._methodName=t},gf=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new Lr(Pr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Lr(Pr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return Wr(this._lat,t._lat)||Wr(this._long,t._long)},t}(),mf=/^__.*__$/,bf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Qo(t,this.data,this.fieldMask,e,this.fieldTransforms):new zo(t,this.data,e,this.fieldTransforms)},t}(),wf=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Qo(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function If(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Kr()}}var Tf=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Dc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Cc",{get:function(){return this.settings.Cc},enumerable:!1,configurable:!0}),t.prototype.Nc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.xc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.kc(t),r},t.prototype.$c=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Nc({path:n,Fc:!1});return r.Dc(),r},t.prototype.Oc=function(t){return this.Nc({path:void 0,Fc:!0})},t.prototype.Mc=function(t){return Bf(t,this.settings.methodName,this.settings.Lc||!1,this.path,this.settings.Bc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Dc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.kc(this.path.get(t))},t.prototype.kc=function(t){if(0===t.length)throw this.Mc("Document fields must not be empty");if(If(this.Cc)&&mf.test(t))throw this.Mc('Document fields cannot begin and end with "__"')},t}(),Ef=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Mc(t)}return t.prototype.qc=function(t,e,n,r){return void 0===r&&(r=!1),new Tf({Cc:t,methodName:e,Bc:n,path:oi.emptyPath(),Fc:!1,Lc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function _f(t){var e=t._freezeSettings(),n=Mc(t._databaseId);return new Ef(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Of(t,e,n,r,i,o){void 0===o&&(o={});var s=t.qc(o.merge||o.mergeFields?2:0,e,n,i);Mf("Data must be an object, but it was:",s,r);var a,u,c=Lf(r,s);if(o.merge)a=new si(s.fieldMask),u=s.fieldTransforms;else if(o.mergeFields){for(var h=[],l=0,f=o.mergeFields;l<f.length;l++){var d=Vf(e,f[l],n);if(!s.contains(d))throw new Lr(Pr.INVALID_ARGUMENT,"Field '"+d+"' is specified in your field mask but missing from your input data.");Kf(h,d)||h.push(d)}a=new si(h),u=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,u=s.fieldTransforms;return new bf(new xi(c),a,u)}var Sf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(xr.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Cc)throw t.Mc(1===t.Cc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(vf);function Df(t,e,n){return new Tf({Cc:3,Bc:e.settings.Bc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Nf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(xr.c)(e,t),e.prototype._toFieldTransform=function(t){return new Po(t.path,new Do)},e.prototype.isEqual=function(t){return t instanceof e},e}(vf),Af=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(xr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Df(this,t,!0),n=this.Uc.map(function(t){return Pf(t,e)}),r=new No(n);return new Po(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(vf),kf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Uc=n,r}return Object(xr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Df(this,t,!0),n=this.Uc.map(function(t){return Pf(t,e)}),r=new ko(n);return new Po(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(vf),Cf=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(xr.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new jo(t.R,To(t.R,this.Qc));return new Po(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(vf);function jf(t,e,n,r){var i=t.qc(1,e,n);Mf("Data must be an object, but it was:",i,r);var o=[],s=xi.empty();ti(r,function(t,r){var a=Uf(e,t,n);r=Object(T.o)(r);var u=i.$c(a);if(r instanceof Sf)o.push(a);else{var c=Pf(r,u);null!=c&&(o.push(a),s.set(a,c))}});var a=new si(o);return new wf(s,a,i.fieldTransforms)}function xf(t,e,n,r,i,o){var s=t.qc(1,e,n),a=[Vf(e,r,n)],u=[i];if(o.length%2!=0)throw new Lr(Pr.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var c=0;c<o.length;c+=2)a.push(Vf(e,o[c])),u.push(o[c+1]);for(var h=[],l=xi.empty(),f=a.length-1;f>=0;--f)if(!Kf(h,a[f])){var d=a[f],p=u[f];p=Object(T.o)(p);var y=s.$c(d);if(p instanceof Sf)h.push(d);else{var v=Pf(p,y);null!=v&&(h.push(d),l.set(d,v))}}var g=new si(h);return new wf(l,g,s.fieldTransforms)}function Rf(t,e,n,r){return void 0===r&&(r=!1),Pf(n,t.qc(r?4:3,e))}function Pf(t,e){if(Ff(t=Object(T.o)(t)))return Mf("Unsupported field value:",e,t),Lf(t,e);if(t instanceof vf)return function(t,e){if(!If(e.Cc))throw e.Mc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Mc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Cc)throw e.Mc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Pf(o[i],e.Oc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(T.o)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return To(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=$r.fromDate(t);return{timestampValue:ks(e.R,n)}}if(t instanceof $r)return n=new $r(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:ks(e.R,n)};if(t instanceof gf)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof yf)return{bytesValue:Cs(e.R,t._byteString)};if(t instanceof Zl){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Mc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Rs(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Mc("Unsupported field value: "+Wl(t))}(t,e)}function Lf(t,e){var n={};return ei(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ti(t,function(t,r){var i=Pf(r,e.xc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function Ff(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof $r||t instanceof gf||t instanceof yf||t instanceof Zl||t instanceof vf)}function Mf(t,e,n){if(!Ff(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=Wl(n);throw e.Mc("an object"===r?t+" a custom object":t+" "+r)}}function Vf(t,e,n){if((e=Object(T.o)(e))instanceof pf)return e._internalPath;if("string"==typeof e)return Uf(t,e);throw Bf("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var qf=new RegExp("[~\\*/\\[\\]]");function Uf(t,e,n){if(e.search(qf)>=0)throw Bf("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(pf.bind.apply(pf,Object(xr.f)([void 0],e.split(".")))))._internalPath}catch(r){throw Bf("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Bf(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var u="";return(o||s)&&(u+=" (found",o&&(u+=" in field "+r),s&&(u+=" in document "+i),u+=")"),new Lr(Pr.INVALID_ARGUMENT,(a+=". ")+t+u)}function Kf(t,e){return t.some(function(t){return t.isEqual(e)})}var Gf=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Zl(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new zf(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Qf("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),zf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(xr.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Gf);function Qf(t,e){return"string"==typeof e?Uf(t,e):e instanceof pf?e._internalPath:e._delegate._internalPath}var Hf=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Wf=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(xr.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new Yf(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Qf("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Gf),Yf=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(xr.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(Wf),Xf=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Hf(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new Yf(n._firestore,n._userDataWriter,r.key,r,new Hf(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Lr(Pr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new Yf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Hf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new Yf(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Hf(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:$f(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function $f(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Kr()}}function Jf(t,e){return t instanceof Wf&&e instanceof Wf?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof Xf&&e instanceof Xf&&t._firestore===e._firestore&&sf(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function Zf(t){if(so(t)&&0===t.explicitOrderBy.length)throw new Lr(Pr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var td=function(){};function ed(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var nd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Kc=e,i.jc=n,i.Wc=r,i.type="where",i}return Object(xr.c)(e,t),e.prototype._apply=function(t){var e=_f(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){cd(s,o);for(var u=[],c=0,h=s;c<h.length;c++)u.push(ud(r,t,h[c]));a={arrayValue:{values:u}}}else a=ud(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||cd(s,o),a=Rf(n,"where",s,"in"===o||"not-in"===o);var l=Ui.create(i,o,a);return function(t,e){if(e.g()){var n=uo(t);if(null!==n&&!n.isEqual(e.field))throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=ao(t);null!==r&&hd(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new Lr(Pr.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,l),l}(t._query,0,e,t.firestore._databaseId,this.Kc,this.jc,this.Wc);return new tf(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new no(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(td),rd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Kc=e,r.Gc=n,r.type="orderBy",r}return Object(xr.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Ji(e,n);return function(t,e){if(null===ao(t)){var n=uo(t);null!==n&&hd(0,n,e.field)}}(t,r),r}(t._query,this.Kc,this.Gc);return new tf(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new no(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(td),id=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.zc=n,i.Hc=r,i}return Object(xr.c)(e,t),e.prototype._apply=function(t){return new tf(t.firestore,t.converter,fo(t._query,this.zc,this.Hc))},e}(td),od=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(xr.c)(e,t),e.prototype._apply=function(t){var e=ad(t,this.type,this.Jc,this.Yc);return new tf(t.firestore,t.converter,function(t,e){return new no(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(td),sd=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Jc=n,i.Yc=r,i}return Object(xr.c)(e,t),e.prototype._apply=function(t){var e=ad(t,this.type,this.Jc,this.Yc);return new tf(t.firestore,t.converter,function(t,e){return new no(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(td);function ad(t,e,n,r){if(n[0]=Object(T.o)(n[0]),n[0]instanceof Gf)return function(t,e,n,r,i){if(!r)throw new Lr(Pr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=ho(t);s<a.length;s++){var u=a[s];if(u.field.isKeyField())o.push(Si(e,r.key));else{var c=r.data.field(u.field);if(fi(c))throw new Lr(Pr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var h=u.field.canonicalString();throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+h+"' (used as the orderBy) does not exist.")}o.push(c)}}return new Xi(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=_f(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new Lr(Pr.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],u=0;u<i.length;u++){var c=i[u];if(s[u].field.isKeyField()){if("string"!=typeof c)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof c);if(!co(t)&&-1!==c.indexOf("/"))throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+c+"' contains a slash.");var h=t.path.child(ri.fromString(c));if(!mi.isDocumentKey(h))throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+h+"' is not because it contains an odd number of segments.");var l=new mi(h);a.push(Si(e,l))}else{var f=Rf(n,r,c);a.push(f)}}return new Xi(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function ud(t,e,n){if("string"==typeof(n=Object(T.o)(n))){if(""===n)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!co(e)&&-1!==n.indexOf("/"))throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(ri.fromString(n));if(!mi.isDocumentKey(r))throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Si(t,new mi(r))}if(n instanceof Zl)return Si(t,n._key);throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Wl(n)+".")}function cd(t,e){if(!Array.isArray(t)||0===t.length)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function hd(t,e,n){if(!n.isEqual(e))throw new Lr(Pr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var ld=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),bi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return hi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(li(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Kr()}},t.prototype.convertObject=function(t,e){var n=this,r={};return ti(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new gf(hi(t.latitude),hi(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=di(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(pi(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=ci(t);return new $r(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=ri.fromString(t);Gr(oa(n));var r=new Pl(n.get(1),n.get(3)),i=new mi(n.popFirst(5));return r.isEqual(e)||qr("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function fd(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var dd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(xr.c)(e,t),e.prototype.convertBytes=function(t){return new yf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Zl(this.firestore,null,e)},e}(ld),pd=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=_f(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=yd(t,this._firestore),i=fd(r.converter,e,n),o=Of(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,Fo.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=yd(t,this._firestore);return o="string"==typeof(e=Object(T.o)(e))||e instanceof pf?xf(this._dataReader,"WriteBatch.update",s._key,e,n,r):jf(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,Fo.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=yd(t,this._firestore);return this._mutations=this._mutations.concat(new Jo(e._key,Fo.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new Lr(Pr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function yd(t,e){if((t=Object(T.o)(t)).firestore!==e)throw new Lr(Pr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var vd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(xr.c)(e,t),e.prototype.convertBytes=function(t){return new yf(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new Zl(this.firestore,null,e)},e}(ld);function gd(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=Yl(t,Zl);var o=Yl(t.firestore,cf),s=_f(o);return bd(o,[("string"==typeof(e=Object(T.o)(e))||e instanceof pf?xf(s,"updateDoc",t._key,e,n,r):jf(s,"updateDoc",t._key,e)).toMutation(t._key,Fo.exists(!0))])}function md(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(T.o)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||uf(i[a])||(s=i[a],a++);var u,c,h,l={includeMetadataChanges:s.includeMetadataChanges};if(uf(i[a])){var f=i[a];i[a]=null===(e=f.next)||void 0===e?void 0:e.bind(f),i[a+1]=null===(n=f.error)||void 0===n?void 0:n.bind(f),i[a+2]=null===(r=f.complete)||void 0===r?void 0:r.bind(f)}if(t instanceof Zl)c=Yl(t.firestore,cf),h=io(t._key.path),u={next:function(e){i[a]&&i[a](wd(c,t,e))},error:i[a+1],complete:i[a+2]};else{var d=Yl(t,tf);c=Yl(d.firestore,cf),h=d._query;var p=new vd(c);u={next:function(t){i[a]&&i[a](new Xf(c,p,d,t))},error:i[a+1],complete:i[a+2]},Zf(t._query)}return function(t,e,n,r){var i=this,o=new bl(r),s=new Ah(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(i,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return e=_h,[4,Cl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(i,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return e=Oh,[4,Cl(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(hf(c),h,l,u)}function bd(t,e){return function(t,e){var n=this,r=new Aa;return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(n,void 0,void 0,function(){var n;return Object(xr.d)(this,function(i){switch(i.label){case 0:return n=Uh,[4,kl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(hf(t),e)}function wd(t,e,n){var r=n.docs.get(e._key),i=new vd(t);return new Wf(t,i,e._key,r,new Hf(n.hasPendingWrites,n.fromCache),e.converter)}var Id=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(xr.c)(e,t),e.prototype.get=function(e){var n=this,r=yd(e,this._firestore),i=new vd(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new Wf(n._firestore,i,r._key,t._document,new Hf(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=_f(t)}return t.prototype.get=function(t){var e=this,n=yd(t,this._firestore),r=new dd(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Kr();var i=t[0];if(i.isFoundDocument())return new Gf(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Gf(e._firestore,r,n._key,null,n.converter);throw Kr()})},t.prototype.set=function(t,e,n){var r=yd(t,this._firestore),i=fd(r.converter,e,n),o=Of(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=yd(t,this._firestore);return o="string"==typeof(e=Object(T.o)(e))||e instanceof pf?xf(this._dataReader,"Transaction.update",s._key,e,n,r):jf(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=yd(t,this._firestore);return this._transaction.delete(e._key),this},t}());function Td(){if("undefined"==typeof Uint8Array)throw new Lr(Pr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Ed(){if("undefined"==typeof atob)throw new Lr(Pr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var _d=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return Ed(),new t(yf.fromBase64String(e))},t.fromUint8Array=function(e){return Td(),new t(yf.fromUint8Array(e))},t.prototype.toBase64=function(){return Ed(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return Td(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),Od=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){df(t=Yl(t,cf));var n=hf(t),r=t._freezeSettings(),i=new ml;return ff(n,i,new vl(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){df(t=Yl(t,cf));var e=hf(t),n=t._freezeSettings(),r=new ml;return ff(e,r,new gl(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new Lr(Pr.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Aa;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(xr.b)(e,void 0,void 0,function(){var e;return Object(xr.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(xr.b)(this,void 0,void 0,function(){return Object(xr.d)(this,function(e){switch(e.label){case 0:return ja.yt()?[4,ja.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Ku(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),Sd=function(){function t(t,e,n){var r=this;this._delegate=e,this.Xc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Pl||(this.Zc=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Ur("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={});var i=(t=Yl(t,Jl))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==e&&Ur("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},i),{host:e+":"+n,ssl:!1})),r.mockUserToken){var o=Object(T.j)(r.mockUserToken),s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Lr(Pr.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");t._credentials=new Vl(new Fl(o,new wc(s)))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(xr.b)(e,void 0,void 0,function(){var e,n;return Object(xr.d)(this,function(r){switch(r.label){case 0:return[4,Dl(t)];case 1:return e=r.sent(),[4,Al(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=zr(t);return e.Or.delete(0),Qc(e)}(n))]}})})})}(hf(Yl(this._delegate,cf)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(xr.b)(e,void 0,void 0,function(){var e,n;return Object(xr.d)(this,function(r){switch(r.label){case 0:return[4,Dl(t)];case 1:return e=r.sent(),[4,Al(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(xr.b)(this,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return(e=zr(t)).Or.add(0),[4,Hc(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(hf(Yl(this._delegate,cf)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&zl("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Xc.enableMultiTabIndexedDbPersistence(this):this.Xc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Xc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.Zc&&(this.Zc._removeServiceInstance("firestore"),this.Zc._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Aa;return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(e,void 0,void 0,function(){var e;return Object(xr.d)(this,function(r){switch(r.label){case 0:return e=Hh,[4,kl(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(hf(Yl(this._delegate,cf)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new bl(e);return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(n,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){zr(t).Gr.add(e),e.next()},[4,Cl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(n,void 0,void 0,function(){var e;return Object(xr.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){zr(t).Gr.delete(e)},[4,Cl(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(hf(t=Yl(t,cf)),uf(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.Zc)throw new Lr(Pr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.Zc},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new qd(this,nf(this._delegate,t))}catch(t){throw jd(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new Cd(this,rf(this._delegate,t))}catch(t){throw jd(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new Fd(this,function(t,e){if(t=Yl(t,Jl),Kl("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new tf(t,null,function(t){return new no(ri.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw jd(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Aa;return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(n,void 0,void 0,function(){var n;return Object(xr.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Sl(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new Il(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(hf(t),function(n){return e(new Id(t,n))})}(this._delegate,function(n){return t(new Nd(e,n))})},t.prototype.batch=function(){var t=this;return hf(this._delegate),new Ad(new pd(this._delegate,function(e){return bd(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new Lr(Pr.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new Lr(Pr.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),Dd=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(xr.c)(e,t),e.prototype.convertBytes=function(t){return new _d(new yf(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return Cd.tu(e,this.firestore,null)},e}(ld),Nd=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new Dd(t)}return t.prototype.get=function(t){var e=this,n=Ud(t);return this._delegate.get(n).then(function(t){return new Pd(e._firestore,new Wf(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Ud(t);return n?(Gl("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ud(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(xr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ud(t);return this._delegate.delete(e),this},t}(),Ad=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Ud(t);return n?(Gl("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Ud(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(xr.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Ud(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),kd=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new Yf(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new Ld(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.eu=function(e,n){var r=t.nu,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new Dd(e),n),i.set(n,o)),o},t}();kd.nu=new WeakMap;var Cd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Dd(t)}return t.su=function(e,n,r){if(e.length%2!=0)throw new Lr(Pr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new Zl(n._delegate,r,new mi(e)))},t.tu=function(e,n,r){return new t(n,new Zl(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new qd(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new qd(this.firestore,nf(this._delegate,t))}catch(t){throw jd(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(T.o)(t))instanceof Zl&&of(this._delegate,t)},t.prototype.set=function(t,e){e=Gl("DocumentReference.set",e);try{return function(t,e,n){t=Yl(t,Zl);var r=Yl(t.firestore,cf),i=fd(t.converter,e,n);return bd(r,[Of(_f(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Fo.none())])}(this._delegate,t,e)}catch(t){throw jd(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?gd(this._delegate,t):gd.apply(void 0,Object(xr.f)([this._delegate,t,e],n))}catch(t){throw jd(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return bd(Yl((t=this._delegate).firestore,cf),[new Jo(t._key,Fo.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=xd(e),i=Rd(e,function(e){return new Pd(t.firestore,new Wf(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return md(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Yl(t,Zl);var e=Yl(t.firestore,cf),n=hf(e),r=new vd(e);return function(t,e){var n=this,r=new Aa;return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(n,void 0,void 0,function(){var n;return Object(xr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i;return Object(xr.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=zr(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new Lr(Pr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=mh(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Nl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new Wf(e,r,t._key,n,new Hf(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Yl(t,Zl);var e=Yl(t.firestore,cf);return jl(hf(e),t._key,{source:"server"}).then(function(n){return wd(e,t,n)})}(this._delegate):function(t){t=Yl(t,Zl);var e=Yl(t.firestore,cf);return jl(hf(e),t._key).then(function(n){return wd(e,t,n)})}(this._delegate)).then(function(t){return new Pd(e.firestore,new Wf(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?kd.eu(this.firestore,e):null))},t}();function jd(t,e,n){return t.message=t.message.replace(e,n),t}function xd(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!uf(r))return r}return{}}function Rd(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=uf(t[0])?t[0]:uf(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var Pd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new Cd(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return Jf(this._delegate,t._delegate)},t}(),Ld=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(xr.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(Pd),Fd=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new Dd(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,ed(this._delegate,function(t,e,n){var r=e,i=Qf("where",t);return new nd(i,r,n)}(e,n,r)))}catch(e){throw jd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,ed(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Qf("orderBy",t);return new rd(r,n)}(e,n)))}catch(e){throw jd(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,ed(this._delegate,function(t){return Xl("limit",t),new id("limit",t,"F")}(e)))}catch(e){throw jd(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,ed(this._delegate,function(t){return Xl("limitToLast",t),new id("limitToLast",t,"L")}(e)))}catch(e){throw jd(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ed(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new od("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw jd(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ed(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new od("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw jd(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ed(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sd("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw jd(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,ed(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new sd("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw jd(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return sf(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=Yl(t,tf);var e=Yl(t.firestore,cf),n=hf(e),r=new vd(e);return function(t,e){var n=this,r=new Aa;return t.asyncQueue.enqueueAndForget(function(){return Object(xr.b)(n,void 0,void 0,function(){var n;return Object(xr.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(xr.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(xr.d)(this,function(u){switch(u.label){case 0:return u.trys.push([0,2,,3]),[4,ic(t,e,!0)];case 1:return a=u.sent(),r=new Rh(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=u.sent(),a=mh(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Nl(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new Xf(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=Yl(t,tf);var e=Yl(t.firestore,cf),n=hf(e),r=new vd(e);return xl(n,t._query,{source:"server"}).then(function(n){return new Xf(e,r,t,n)})}(this._delegate):function(t){t=Yl(t,tf);var e=Yl(t.firestore,cf),n=hf(e),r=new vd(e);return Zf(t._query),xl(n,t._query).then(function(n){return new Xf(e,r,t,n)})}(this._delegate)).then(function(t){return new Vd(e.firestore,new Xf(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=xd(e),i=Rd(e,function(e){return new Vd(t.firestore,new Xf(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return md(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?kd.eu(this.firestore,e):null))},t}(),Md=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new Ld(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),Vd=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new Fd(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new Ld(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new Md(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new Ld(n._firestore,r))})},t.prototype.isEqual=function(t){return Jf(this._delegate,t._delegate)},t}(),qd=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(xr.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new Cd(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new Cd(this.firestore,void 0===t?rf(this._delegate):rf(this._delegate,t))}catch(t){throw jd(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=Yl(t.firestore,cf),r=rf(t),i=fd(t.converter,e);return bd(n,[Of(_f(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,Fo.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new Cd(e.firestore,t)})},e.prototype.isEqual=function(t){return of(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?kd.eu(this.firestore,t):null))},e}(Fd);function Ud(t){return Yl(t,Zl)}var Bd,Kd=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(pf.bind.apply(pf,Object(xr.f)([void 0],t)))}return t.documentId=function(){return new t(oi.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(T.o)(t))instanceof pf&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Gd=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Nf("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Sf("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Af("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new kf("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new Cf("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),zd=n("/6Yf"),Qd={Firestore:Sd,GeoPoint:gf,Timestamp:$r,Blob:_d,Transaction:Nd,WriteBatch:Ad,DocumentReference:Cd,DocumentSnapshot:Pd,Query:Fd,QueryDocumentSnapshot:Ld,QuerySnapshot:Vd,CollectionReference:qd,FieldPath:Kd,FieldValue:Gd,setLogLevel:function(t){Fr.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};(function(t,e){t.INTERNAL.registerComponent(new zd.a("firestore",function(t){return function(t,e){return new Sd(t,new cf(t,e),new Od)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Qd)))})(Bd=I.a),Bd.registerVersion("@firebase/firestore","2.3.6");var Hd=n("UbJi");function Wd(t,e){return function(t,e=i.b){return new o.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function Yd(t,e){return Wd(t,e).pipe(Object(d.a)(t=>({payload:t,type:"query"})))}function Xd(t,e){return Yd(t,e).pipe(Object(u.a)(void 0),h(),Object(d.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function $d(t,e,n){return Xd(t,n).pipe(Object(p.a)((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return Jd(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return Jd(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return Jd(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Object(y.a)(),Object(d.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function Jd(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function Zd(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}class tp{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=Xd(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(d.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(Object(u.a)(void 0),h(),Object(v.a)(([t,e])=>e.length>0||!t),Object(d.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(p.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Zd(t);return $d(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Yd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(d.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new ep(this.ref.doc(t),this.afs)}}class ep{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=ap(n,e);return new tp(r,i,this.afs)}snapshotChanges(){return Wd(this.ref,this.afs.schedulers.outsideAngular).pipe(Object(u.a)(void 0),h(),Object(d.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(d.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(s.a)(this.ref.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}}class np{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?Xd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(d.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Object(v.a)(t=>t.length>0),this.afs.keepUnstableUntilFirst):Xd(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(Object(p.a)((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=Zd(t);return $d(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return Yd(this.query,this.afs.schedulers.outsideAngular).pipe(Object(d.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(s.a)(this.query.get(t)).pipe(Object(g.b)(this.afs.schedulers.insideAngular))}}const rp=new r.s("angularfire2.enableFirestorePersistence"),ip=new r.s("angularfire2.firestore.persistenceSettings"),op=new r.s("angularfire2.firestore.settings"),sp=new r.s("angularfire2.firestore.use-emulator");function ap(t,e=(t=>t)){return{query:e(t),ref:t}}let up=(()=>{class t{constructor(t,e,n,r,i,o,u,c,h){this.schedulers=new m.d(o),this.keepUnstableUntilFirst=Object(m.h)(this.schedulers);const l=Object(m.g)(t,o,e);!w.a.auth&&h&&Object(m.j)();const f=c;[this.firestore,this.persistenceEnabled$]=Object(m.f)(`${l.name}.firestore`,"AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),f&&t.useEmulator(...f),n&&!Object(b.p)(i)){const e=()=>{try{return Object(s.a)(t.enablePersistence(u||void 0).then(()=>!0,()=>!1))}catch(Bd){return"undefined"!=typeof console&&console.warn(Bd),Object(a.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(a.a)(!1)]},[r,f,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=ap(n,e),o=this.schedulers.ngZone.run(()=>r);return new tp(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new np(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new ep(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(r.Vb(m.c),r.Vb(m.b,8),r.Vb(rp,8),r.Vb(op,8),r.Vb(r.D),r.Vb(r.B),r.Vb(ip,8),r.Vb(sp,8),r.Vb(Hd.c,8))},t.\u0275prov=r.Ib({factory:function(){return new t(r.Vb(m.c),r.Vb(m.b,8),r.Vb(rp,8),r.Vb(op,8),r.Vb(r.D),r.Vb(r.B),r.Vb(ip,8),r.Vb(sp,8),r.Vb(Hd.c,8))},token:t,providedIn:"any"}),t})()}}]);